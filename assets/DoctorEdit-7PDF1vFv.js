import{D as S,r as c,k as w,c as C,a as m,l as V,j as e,F as I,b as q,m as A,q as p,S as F,A as b,p as z,P as D,V as h,h as B,Y as T,y as Y,H}from"./index--oTFs3gJ.js";import{H as M}from"./HeadingPlusBackBtn-CCyxk8gb.js";import{h as K}from"./moment-C5S46NFB.js";import{i as _,a as k}from"./index-tNe2wjfG.js";import{I as v}from"./Input-DgXnbsb9.js";import{C as Q}from"./CountrySearchInput-DIy4l0Go.js";import{S as G,C as J}from"./CitySearchInput-CCaZ6Mxn.js";/* empty css                     */import"./index.modern-BDAvcjIR.js";import{S as W}from"./SingleImageUpload-CsFqmQgm.js";import{P as X}from"./PhoneInput-IZNzD7W7.js";import{g as Z}from"./index-CtnJN3Yv.js";import{D as E,U as $}from"./apiEndpoints-DA67aB0N.js";import"./BackButton-BekUZv0_.js";import"./index-CvwiJHFK.js";import"./index-BVp46ldf.js";import"./index-oiI3A1nS.js";import"./no-image-icon-CabPHXKl.js";function ee(){const{id:s}=S(),[a,l]=c.useState(""),[d,o]=c.useState(""),[u,x]=c.useState(""),[g,j]=c.useState("");c.useEffect(()=>{if(a){const t=new Intl.DisplayNames(["en"],{type:"region"});o(t.of(a))}},[a]);const n=async()=>s?(await b.get(`${E}/${s}`)).data.data.doc:null,{data:r,isLoading:i,isError:f,error:y}=w({queryKey:["doctor",s],queryFn:n,enabled:!!s,staleTime:5*60*1e3,cacheTime:30*60*1e3});c.useEffect(()=>{r&&(l(Z(r==null?void 0:r.countryCode)||(r==null?void 0:r.countryCode)||""),x((r==null?void 0:r.province)||""))},[r]);const R=()=>{var t;return{imageDataURI:null,fullName:(r==null?void 0:r.fullName)||((t=r==null?void 0:r.user)==null?void 0:t.username)||"",email:(r==null?void 0:r.email)||"",countryName:(r==null?void 0:r.countryName)||"",province:(r==null?void 0:r.province)||"",city:(r==null?void 0:r.city)||"",phone:(r==null?void 0:r.phone)||""}},L=C().shape({imageDataURI:V().nullable().test("fileSize","Image size must be less than 4MB",t=>t===null||t instanceof File&&t.size<=4*1024*1024).test("fileFormat","Accepted formats are jpg, png",t=>t===null||t instanceof File&&["image/jpeg","image/png"].includes(t.type)).required("Image is required"),fullName:m().required("Full Name is required"),email:m().email("Please enter valid email").required("Email is required"),countryName:m().required("Country Name is required"),province:m().optional(),city:m().optional(),phone:m().test("is-possible-phone","Please enter valid phone number",t=>t?_(t):!0).test("is-valid-phone","Please enter valid phone number",t=>t?k(t):!0).required("Phone is required")}),O=async t=>{const{fullName:N,email:P,phone:se,...U}=t;console.log({...U,imageDataURI:g,dateOfBirth:K(t==null?void 0:t.dateOfBirth).format("YYYY-MM-DD"),countryCode:a,doctorId:s})};return i?e.jsx("div",{className:"flex justify-center items-center h-64 text-darkBlue",children:"Loading profile data..."}):f?e.jsxs("div",{className:"flex justify-center items-center h-64 text-red-500",children:["Error loading profile: ",y.message]}):r?e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(I,{initialValues:R(),validationSchema:L,onSubmit:O,enableReinitialize:!0,children:t=>{var N,P;return e.jsxs(q,{className:"flex flex-col gap-3 p-5 bg-white rounded-[20px] border border-lightBlue shadow",autoComplete:"off",children:[e.jsx("p",{className:"text-xl text-darkBlue font-[500] border-b border-b-lightBlue pb-2",children:"Profile Settings"}),e.jsx("div",{className:"",children:e.jsx(W,{formik:t,name:"imageDataURI",id:"imageDataURI",label:"Profile Image",base64Image:g,setBase64Image:j,backendImage:(N=r==null?void 0:r.user)!=null&&N.image?`${A}/${(P=r==null?void 0:r.user)==null?void 0:P.image}`:r!=null&&r.image?`${A}/${r==null?void 0:r.image}`:""})}),e.jsxs(p,{children:[e.jsx("div",{className:"w-full",children:e.jsx(v,{formik:t,name:"fullName",id:"fullName",label:"Full Name",disabled:!0,hintOn:!0,hintText:"Name can't be edited"})}),e.jsx("div",{className:"w-full",children:e.jsx(v,{formik:t,name:"email",id:"email",label:"Email",disabled:!0,hintOn:!0,hintText:"Email can't be edited"})})]}),e.jsxs(p,{children:[e.jsx("div",{className:"w-full",children:e.jsx(X,{name:"phone",id:"phone",label:"Phone",country:a,disabled:!0,hintOn:!0,hintText:"Phone can't be edited"})}),e.jsx("div",{className:"w-full",children:e.jsx(Q,{formik:t,name:"countryName",id:"countryName",label:"Country",getCountryCode:l})})]}),e.jsxs(p,{children:[e.jsx("div",{className:"w-full",children:e.jsx(G,{formik:t,name:"province",id:"province",label:"State/Province",countryName:d,getStateName:x})}),e.jsx("div",{className:"w-full",children:e.jsx(J,{formik:t,name:"city",id:"city",label:"City",countryName:d,stateName:u})})]}),e.jsx("div",{className:"mt-2",children:e.jsx(F,{formik:t})})]})}})})}):e.jsx("div",{className:"flex justify-center items-center h-64 text-gray-500",children:"No profile data found for this ID."})}T(Y);function re(){const{id:s}=S(),a={newPassword:"",confirmPassword:""},l=C().shape({newPassword:m().password().required("New Password is required"),confirmPassword:m().oneOf([z("newPassword"),null],"Passwords do not match").required("Confirm password is required")}),d=async o=>{try{console.log({...o,doctorId:s})}catch(u){h.error(B(u))}};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(I,{initialValues:a,validationSchema:l,onSubmit:d,enableReinitialize:!0,children:o=>e.jsxs(q,{className:"flex flex-col gap-3 p-5 bg-white rounded-[20px] border border-lightBlue shadow",children:[e.jsxs(p,{children:[e.jsx("div",{className:"w-full",children:e.jsx(D,{formik:o,name:"newPassword",id:"newPassword",label:"New Password"})}),e.jsx("div",{className:"w-full",children:e.jsx(D,{formik:o,name:"confirmPassword",id:"confirmPassword",label:"Confirm Password"})})]}),e.jsx("div",{className:"mt-2",children:e.jsx(F,{formik:o})})]})})})})}function te(){const{id:s}=S(),{data:a,isLoading:l,refetch:d}=w({queryKey:["adminProfit",s],queryFn:async()=>{var n,r;try{const i=await b.get(`${$}/admin-profit/doctor/${s}`);return(r=(n=i==null?void 0:i.data)==null?void 0:n.data)==null?void 0:r.doc}catch(i){if(i.response&&i.response.status===404)return null;throw i}},enabled:!!s}),{data:o,isLoading:u}=w({queryKey:["doctor",s],queryFn:async()=>{var r,i;const n=await b.get(`${E}/${s}`);return(i=(r=n==null?void 0:n.data)==null?void 0:r.data)==null?void 0:i.doc},enabled:!!s}),x={adminProfit:(a==null?void 0:a.adminProfit)||""},g=C().shape({adminProfit:H().typeError("Admin Profit must be a number").positive("Admin Profit must be a positive number").min(0,"Admin Profit cannot be less than 0").max(100,"Admin Profit cannot be more than 100").required("Admin Profit is required")}),j=async n=>{var i;const r=(i=o==null?void 0:o.user)==null?void 0:i._id;if(!r){h.error("Could not find the doctor's user ID.");return}try{const f={user:r,role:"doctor",adminProfit:n.adminProfit},y=await b.post(`${$}/admin-profit`,f);a?h.success("Admin profit updated successfully!"):h.success("Admin profit set successfully!"),console.log(y.data),d()}catch(f){h.error(B(f))}};return l||u?e.jsx("div",{className:"flex justify-center items-center h-64 text-darkBlue",children:"Loading Admin Profit data..."}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(I,{initialValues:x,validationSchema:g,onSubmit:j,enableReinitialize:!0,children:n=>e.jsxs(q,{className:"flex flex-col gap-3 p-5 bg-white rounded-[20px] border border-lightBlue shadow",children:[e.jsxs(p,{children:[e.jsx("div",{className:"w-full",children:e.jsx(v,{formik:n,name:"adminProfit",id:"adminProfit",label:"Admin Profit %"})}),e.jsx("div",{className:"w-full"})]}),e.jsx("div",{className:"mt-2",children:e.jsx(F,{formik:n})})]})})})})}function Pe(){const[s,a]=c.useState("profile"),l=d=>`cursor-pointer px-4 py-2 rounded-md transition-colors max-[500px]:w-full ${s===d?"bg-myBlue text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsx("div",{className:"",children:e.jsx(M,{label:"Edit Doctor"})}),e.jsxs("div",{className:"flex items-center gap-5 max-[500px]:flex-col ",children:[e.jsx("button",{type:"button",className:l("profile"),onClick:()=>a("profile"),children:"Profile"}),e.jsx("button",{type:"button",className:l("password"),onClick:()=>a("password"),children:"Change Password"}),e.jsx("button",{type:"button",className:l("admin-profit"),onClick:()=>a("admin-profit"),children:"Set Admin Profit"})]}),e.jsx("div",{children:s==="profile"?e.jsx(ee,{}):s==="password"?e.jsx(re,{}):e.jsx(te,{})})]})})}export{Pe as default};
