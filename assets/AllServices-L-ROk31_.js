import{r as n,k as F,j as e,m as R,E,A as S,V as I,h as D,c as q,a as U,l as B,F as L,b as z}from"./index-BsC4CiLt.js";import{N as V}from"./no-image-icon-CabPHXKl.js";import{I as P,a as K}from"./IsError-DysmRO1f.js";import{N as M}from"./NoData-CEn6Zv-n.js";/* empty css                */import"./index-DInAQVjv.js";function _({formik:r,name:a="",id:i="",getSpecialityId:w=()=>{}}){var y,C;const[j,o]=n.useState(!1),m=n.useRef(null);n.useEffect(()=>{if(r.values[a]){const s=setTimeout(()=>{},300);return()=>{clearTimeout(s)}}},[r.values,a]);const{isLoading:f,isError:b,data:d,error:v}=F({queryKey:["specialities",r.values[a]],queryFn:async()=>(await S.get(`/speciality?keyword=${r.values[a]}`)).data,enabled:!!r.values[a],staleTime:500}),N=s=>{r.handleChange(s),o(!0)},c=s=>{var l;r.setFieldValue(a,s.title),w(s._id),o(!1),(l=m.current)==null||l.blur()},u=(C=(y=d==null?void 0:d.data)==null?void 0:y.docs)==null?void 0:C.filter(s=>{var l;return s.title.toLowerCase().includes(((l=r.values[a])==null?void 0:l.toLowerCase())||"")});return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative flex flex-col gap-3",children:[e.jsxs("label",{htmlFor:i,className:"block text-sm font-medium text-[#252C62] text-[18px]",children:["Speciality ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{ref:m,type:"text",name:a,id:i,className:"border border-[#AEC8E2] w-full rounded-[8px] px-4 py-2 bg-white text-[#202224] font-normal",value:r.values[a],onChange:N,onFocus:()=>o(!0),onBlur:()=>setTimeout(()=>o(!1),100),autoComplete:"off"}),f&&r.values[a]&&e.jsx("div",{className:"absolute z-10 w-full bg-white border border-gray-300 rounded-b-md shadow-lg top-full",children:e.jsx("div",{className:"p-2 text-gray-500",children:"Loading suggestions..."})}),b&&r.values[a]&&e.jsx("div",{className:"absolute z-10 w-full bg-white border border-gray-300 rounded-b-md shadow-lg top-full",children:e.jsxs("div",{className:"p-2 text-red-500",children:["Error: ",v.message]})}),j&&r.values[a]&&(u==null?void 0:u.length)>0&&e.jsx("ul",{className:"absolute z-10 w-full bg-white border border-gray-300 rounded-b-md shadow-lg max-h-60 overflow-y-auto top-full",children:u.map(s=>e.jsxs("li",{className:"flex items-center px-4 py-2 cursor-pointer hover:bg-gray-100",onClick:()=>c(s),children:[s.image&&e.jsx("img",{src:`${R}/${s.image}`,alt:s.title,className:"w-8 h-8 mr-2 rounded-full object-cover",onError:l=>{l.target.onerror=null,l.target.src="https://placehold.co/40x40/cccccc/000000?text=No+Img"}}),s.title]},s._id))}),j&&r.values[a]&&!f&&!b&&(u==null?void 0:u.length)===0&&e.jsx("div",{className:"absolute z-10 w-full bg-white border border-gray-300 rounded-b-md shadow-lg top-full",children:e.jsx("div",{className:"p-2 text-gray-500",children:"No suggestions found."})}),e.jsx(E,{name:a,component:"div",className:"text-sm text-red-500"})]})})}function O({getSpecialityId:r=()=>{}}){const[a,i]=n.useState(""),[w,j]=n.useState(""),[o,m]=n.useState(!1),f=n.useRef(null),b=n.useRef(null),d=n.useRef(null);n.useEffect(()=>(d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{j(a)},300),()=>{d.current&&clearTimeout(d.current)}),[a]);const{isLoading:v,isError:N,data:c,error:u}=F({queryKey:["specialities",w],queryFn:async()=>(await S.get(`/speciality?keyword=${w}`)).data.data.docs,staleTime:5*60*1e3,cacheTime:10*60*1e3,keepPreviousData:!0});n.useEffect(()=>{const s=l=>{f.current&&!f.current.contains(l.target)&&b.current&&!b.current.contains(l.target)&&m(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]);const y=s=>{const l=s.target.value;i(l),m(!0)},C=s=>{i(s.title),j(s.title),r(s._id),m(!1)};return v&&!c?e.jsx("p",{className:"text-[#252C62] font-[600]",children:"Loading specialities..."}):N?e.jsxs("p",{className:"text-red-500 font-[600]",children:["Error: ",u.message]}):e.jsxs("div",{className:"relative flex flex-col gap-3 text-[#252C62] font-[600]",children:[e.jsx("label",{htmlFor:"speciality-search-input",className:"text-[#252C62] font-[600]",children:"Search Speciality"}),e.jsx("input",{ref:f,type:"text",id:"speciality-search-input",className:"border border-[#AEC8E2] w-full rounded-[8px] px-4 py-2 bg-white text-[#202224] font-normal focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Type to search specialities...",value:a,onChange:y,onFocus:()=>m(!0)}),o&&c&&c.length>0&&e.jsx("div",{ref:b,className:"absolute z-10 w-full bg-white border border-[#AEC8E2] rounded-[8px] mt-1 top-full shadow-lg max-h-60 overflow-y-auto",children:c.map(s=>e.jsxs("div",{className:"flex items-center p-3 cursor-pointer hover:bg-gray-100 border-b border-gray-200 last:border-b-0",onClick:()=>C(s),children:[s.image&&e.jsx("img",{src:`${R}/${s.image}`,alt:s.title,className:"w-10 h-10 rounded-full object-cover mr-3",onError:l=>{l.target.onerror=null,l.target.src="https://placehold.co/40x40/cccccc/000000?text=No+Img"}}),e.jsx("span",{className:"text-[#202224] font-normal",children:s.title})]},s._id))}),o&&c&&c.length===0&&a&&e.jsxs("div",{className:"absolute z-10 w-full bg-white border border-[#AEC8E2] rounded-[8px] mt-1 top-full shadow-lg p-3 text-center text-gray-500",children:['No specialities found for "',a,'"']})]})}function X(){var l,A;const r={imageDataURI:null,title:"",speciality:""},[a,i]=n.useState(""),[w,j]=n.useState(""),[o,m]=n.useState(""),f=["fetch-services",{specialitySelectId:o}],{isLoading:b,isError:d,data:v,error:N}=F({queryKey:f,queryFn:()=>S.get(`/service?specialityObjectId=${o}`),enabled:!!o}),c=(A=(l=v==null?void 0:v.data)==null?void 0:l.data)==null?void 0:A.docs;n.useEffect(()=>{N&&I.error(D(N))},[N]);const u=q().shape({imageDataURI:B().nullable().test("fileSize","Image size must be less than 4MB",t=>t===null||t instanceof File&&t.size<=4*1024*1024).test("fileFormat","Accepted formats are jpg, png, svg",t=>t===null||t instanceof File&&["image/jpeg","image/png","image/svg+xml"].includes(t.type)).required("Image is required"),title:U().required("Title is required"),speciality:U().required("Speciality is required")}),y=n.useCallback(t=>new Promise((x,g)=>{const p=new FileReader;p.onloadend=()=>x(p.result),p.onerror=g,p.readAsDataURL(t)}),[]),C=n.useCallback(async(t,x)=>{x.setFieldValue("imageDataURI",t.currentTarget.files[0]);const g=t.currentTarget.files[0];if(g){const p=await y(g);i(p)}else i("")},[y]),s=async(t,{setSubmitting:x,resetForm:g})=>{var p;x(!0);try{const{speciality:T,...$}=t,{data:h}=await S.post("/service",{...$,specialityObjectId:w,imageDataURI:a,status:"Approved"});h!=null&&h.success&&I.success((h==null?void 0:h.message)||((p=h==null?void 0:h.data)==null?void 0:p.message))}catch(T){I.error(D(T))}finally{x(!1),g(),i("")}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsx("div",{className:"flex max-[450px]:flex-col gap-3 items-center justify-between",children:e.jsx("h1",{className:"main-heading",children:"All Services"})}),e.jsxs("div",{className:"border border-[#AEC8E2] bg-white rounded-[20px] p-[20px] flex flex-col gap-5",children:[e.jsx("h2",{className:"font-[500] text-[#252C62] text-[20px] pb-[20px] border-b border-b-[#aec8e2]",children:"Add Services"}),e.jsx(L,{initialValues:r,validationSchema:u,onSubmit:s,enableReinitialize:!0,children:t=>e.jsxs(z,{children:[e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-col gap-5 border border-[#AEC8E2] p-5 rounded-[14px]",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"imageDataURI",className:"block text-[18px] font-[500] text-[#252C62]",children:"Image"}),e.jsxs("div",{className:"mt-1 flex max-[601px]:flex-col max-[601px]:items-start items-center gap-5",children:[e.jsx("div",{className:"relative w-[110px] h-[110px] rounded-[15px] border border-[#AEC8E2] bg-[#F1F5F9] flex items-center justify-center",children:a?e.jsx("img",{src:a,alt:"Profile Preview",className:"w-full h-full object-cover rounded-[15px]"}):e.jsx("img",{src:V,alt:"no image"})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",id:"imageDataURI",name:"imageDataURI",onChange:x=>C(x,t),className:"hidden",form:t}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{htmlFor:"imageDataURI",className:"cursor-pointer font-[500] text-[#202224] text-[16px]",children:"Upload New"}),a&&e.jsx("button",{type:"button",onClick:()=>{t.setFieldValue("imageDataURI",null),i("")},className:"text-red-500 text-[16px] cursor-pointer",form:t,children:"Remove"})]}),e.jsx("p",{className:"text-[#202224] text-[14px] font-[400]",children:"Your Image should Below 4 MB, Accepted format jpg,png,svg"})]})]})]})]}),e.jsx(E,{name:"imageDataURI",component:"div",className:"text-sm text-red-500"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{htmlFor:"title",className:"block text-sm font-medium text-[#252C62] text-[18px]",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"title",name:"title",onChange:t.handleChange,onBlur:t.handleBlur,value:t.values.title,className:"mt-1 block w-full rounded-[6px] px-4 py-2 border border-[#AEC8E2]",form:t}),e.jsx(E,{name:"title",component:"div",className:"text-sm text-red-500"})]}),e.jsx("div",{className:"",children:e.jsx(_,{formik:t,name:"speciality",id:"speciality",getSpecialityId:j})})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-5",children:[e.jsx("button",{type:"button",className:"rounded-[20px] cursor-pointer border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",onClick:()=>{t.resetForm(),i("")},children:"Cancel"}),e.jsx("button",{type:"submit",className:`${t!=null&&t.isSubmitting?"cursor-not-allowed":"cursor-pointer"} bg-[#4C63BD] inline-flex justify-center rounded-[20px] border border-transparent py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-500`,disabled:t==null?void 0:t.isSubmitting,children:"Submit"})]})]})})]}),e.jsx("div",{className:"",children:e.jsx(O,{getSpecialityId:m})}),e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsx("h3",{className:"font-[600] text-[20px] text-[#252C62]",children:"Services"}),o?b?e.jsx(P,{}):d?e.jsx(K,{}):!c||(c==null?void 0:c.length)===0?e.jsx(M,{goBackButton:!1}):e.jsx("div",{className:"services-grid-div",children:c==null?void 0:c.map((t,x)=>e.jsx("div",{className:"border border-lightBlue rounded-[10px] bg-white p-5",children:e.jsxs("div",{className:"flex max-[500px]:flex-col max-[500px]:items-start items-center gap-3",children:[e.jsx("div",{className:"w-[80px] h-[80px] rounded-full",children:e.jsx("img",{src:`${R}/${t==null?void 0:t.image}`,alt:"service image",className:"rounded-full inline-flex object-cover w-full h-full",onError:g=>{g.target.onerror=null,g.target.src="https://placehold.co/40x40/cccccc/000000?text=No+Img"}})}),e.jsx("p",{children:t==null?void 0:t.title})]})},x))}):e.jsx("div",{className:"text-center text-gray-500 text-lg py-10",children:"Please select a speciality to view services."})]})]})})}export{X as default};
