import{r as a,j as e,E as k}from"./index-B1B7tQkZ.js";/* empty css                     */import{u as N,A as S,M as I,a as G,b as R,C as $,c as D,d as _}from"./index.modern-MPEJVs_O.js";import{I as B}from"./index-C65JF4bN.js";function V({formik:n,label:l="Address"}){const[p,c]=a.useState(!1),[o,i]=a.useState(null),[y,f]=a.useState(null),[x,j]=a.useState(!1),[m,h]=a.useState(!1),[r,A]=a.useState(null),[C,q]=N(),b="AIzaSyDIBfIEiwZqaEBV1N2DbCogGhHLfsyhR6c",g={lat:40.7128,lng:-74.006},E=()=>new Promise(s=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const d={lat:t.coords.latitude,lng:t.coords.longitude};i(d),f(d),s(d)},t=>{console.error("Geolocation error:",t),i(g),f(g),alert("Could not retrieve your location. Using a default location."),s(g)}):(i(g),f(g),alert("Geolocation is not supported by your browser. Using a default location."),s(g))}),P=async(s,t)=>{if(!s||!t)return console.error("Invalid coordinates for geocoding"),"Could not determine address";h(!0);try{const d=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${s},${t}&key=${b}`);if(!d.ok)throw new Error(`Geocoding API request failed: ${d.statusText}`);const u=await d.json();if(u.status==="OK"&&u.results&&u.results.length>0){const w=u.results[0].formatted_address;return console.log("Geocoding result:",w),h(!1),w}else return console.error("Geocoding failed:",u.status,u.error_message),h(!1),`Address not found (${u.status})`}catch(d){return console.error("Error during geocoding fetch:",d),h(!1),"Geocoding request failed"}},v=s=>{s.target.classList.contains("address-input-modal")&&c(!1)},L=a.useCallback(s=>{if(s.latLng){const t={lat:s.latLng.lat(),lng:s.latLng.lng()};console.log("Marker dragged to:",t),i(t)}},[]),M=async()=>{if(o){const s=await P(o.lat,o.lng);n.setFieldValue("address",s),c(!1)}else alert("Please select a location on the map first.")};return a.useEffect(()=>{var s;if(r&&((s=r.geometry)!=null&&s.location)){const t={lat:r.geometry.location.lat(),lng:r.geometry.location.lng()};i(t),f(t)}},[r]),a.useEffect(()=>{var s;if(r&&((s=r.geometry)!=null&&s.location)){const t={lat:r.geometry.location.lat(),lng:r.geometry.location.lng()};i(t),f(t)}},[r]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{htmlFor:"address",className:"block text-[18px] font-[500] text-[#252C62]",children:l}),e.jsx("input",{className:`${x?"cursor-wait":"cursor-pointer"} border border-[#AEC8E2] rounded-[6px] px-4 py-2 w-full`,type:"text",name:"address",id:"address",placeholder:x?"Loading Map...":"Select Address",value:n.values.address,readOnly:!0,onClick:async()=>{x||m||(c(!0),j(!1),await E(),j(!1))},disabled:x||m}),e.jsx(k,{name:"address",component:"div",className:"text-sm text-red-500"})]}),p&&e.jsx("div",{className:"address-input-modal",onClick:v,children:e.jsxs("div",{className:"address-map-container",children:[e.jsxs("div",{className:"address-map",children:[y&&o&&e.jsxs(S,{apiKey:b,children:[e.jsx(I,{mapId:"address-map",defaultCenter:y,defaultZoom:16,gestureHandling:"greedy",children:e.jsx(G,{ref:C,position:o,draggable:!0,onDragEnd:L})}),e.jsx(R,{position:$.LEFT_TOP,children:e.jsx("div",{className:"ml-[10px]",children:e.jsx(O,{onPlaceSelect:A})})}),e.jsx(F,{place:r})]}),!y&&!o&&e.jsx("p",{children:"Loading map..."})]}),e.jsxs("div",{className:"flex items-center justify-end gap-5 mt-4",children:[" ",e.jsx("div",{children:e.jsx("button",{type:"button",className:"px-4 py-2 rounded-[8px] bg-[#4C63BD] text-white cursor-pointer disabled:opacity-50",onClick:M,disabled:!o||m,children:m?"Loading...":"Select Address"})}),e.jsx("div",{children:e.jsx("button",{type:"button",className:"px-4 py-2 rounded-[8px] bg-white border border-[#AEC8E2] cursor-pointer",onClick:()=>{c(!1)},disabled:m,children:"Cancel"})})]})]})})]})}const F=({place:n})=>{const l=_();return a.useEffect(()=>{var p;!l||!n||!((p=n.geometry)!=null&&p.viewport)||l.fitBounds(n.geometry.viewport)},[l,n]),null},O=({onPlaceSelect:n})=>{const[l,p]=a.useState(null),c=a.useRef(null),o=D("places");return a.useEffect(()=>{if(!o||!c.current)return;const i={fields:["geometry","name","formatted_address"]};p(new o.Autocomplete(c.current,i))},[o]),a.useEffect(()=>{l&&l.addListener("place_changed",()=>{n(l.getPlace())})},[n,l]),e.jsxs("div",{className:"flex items-center border border-gray-300 bg-white text-black rounded-[20px]",children:[e.jsx("span",{className:"pl-2 text-gray-500",children:e.jsx(B,{})}),e.jsx("input",{ref:c,className:"w-[175px] py-2 px-2 outline-none",type:"search",name:"search",id:"search","aria-label":"Search",placeholder:"Search"})]})};export{V as A};
