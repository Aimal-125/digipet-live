import{D as I,G as H,r as p,k as S,c as q,a as u,l as K,j as e,F,b as $,m as B,q as j,S as A,A as x,V as f,h as D,p as Q,P as R,Y as _,y as G,I as M}from"./index-90C_iGnH.js";import{H as Y}from"./HeadingPlusBackBtn-BmGkcs0Z.js";import"./moment-C5S46NFB.js";import{i as k,a as J}from"./index-BZFQK5FB.js";import{I as C}from"./Input-NYo6jH4B.js";import{C as W}from"./CountrySearchInput-NmGWSVL7.js";import{S as X,C as Z}from"./CitySearchInput-DJwWBr5J.js";import"./index.modern-DR-aB_7J.js";import{S as ee}from"./SingleImageUpload-D-v9muW8.js";import{P as se}from"./PhoneInput-C3xAMeSO.js";import{g as re}from"./index-BiCNRH9L.js";import{D as N,U as L}from"./apiEndpoints-DA67aB0N.js";import"./BackButton-CkQpbmPE.js";import"./index-DN2uC23I.js";import"./index-YtPAdDxb.js";import"./index-nI4YGiSl.js";import"./no-image-icon-CabPHXKl.js";function te(){const{id:t}=I(),o=H(),[i,m]=p.useState(""),[l,g]=p.useState(""),[h,a]=p.useState(""),[y,n]=p.useState("");p.useEffect(()=>{if(i){const r=new Intl.DisplayNames(["en"],{type:"region"});g(r.of(i))}},[i]);const c=async()=>t?(await x.get(`${N}/${t}`)).data.data.doc:null,{data:s,isLoading:b,isError:P,error:U}=S({queryKey:["doctor",t],queryFn:c,enabled:!!t,staleTime:5*60*1e3,cacheTime:30*60*1e3});p.useEffect(()=>{s&&(m(re(s==null?void 0:s.countryCode)||(s==null?void 0:s.countryCode)||""),a((s==null?void 0:s.province)||""))},[s]);const V=()=>{var r;return{imageDataURI:null,fullName:(s==null?void 0:s.fullName)||((r=s==null?void 0:s.user)==null?void 0:r.username)||"",email:(s==null?void 0:s.email)||"",countryName:(s==null?void 0:s.countryName)||"",province:(s==null?void 0:s.province)||"",city:(s==null?void 0:s.city)||"",phone:(s==null?void 0:s.phone)||""}},O=q().shape({imageDataURI:K().nullable().test("fileSize","Image size must be less than 4MB",r=>r===null||r instanceof File&&r.size<=4*1024*1024).test("fileFormat","Accepted formats are jpg, png",r=>r===null||r instanceof File&&["image/jpeg","image/png"].includes(r.type)).required("Image is required"),fullName:u().required("Full Name is required"),email:u().email("Please enter valid email").required("Email is required"),countryName:u().required("Country Name is required"),province:u().optional(),city:u().optional(),phone:u().test("is-possible-phone","Please enter valid phone number",r=>r?k(r):!0).test("is-valid-phone","Please enter valid phone number",r=>r?J(r):!0).required("Phone is required")}),z=async r=>{var E;const{fullName:w,email:v,phone:ne,bloodGroup:oe,...T}=r;try{const{data:d}=await x.patch(`${N}/${t}`,{...T,imageDataURI:y,countryCode:i});d!=null&&d.success&&(f.success(((E=d==null?void 0:d.data)==null?void 0:E.message)||(d==null?void 0:d.message)),o.invalidateQueries(["doctor",t]))}catch(d){f.error(D(d))}};return b?e.jsx("div",{className:"flex justify-center items-center h-64 text-darkBlue",children:"Loading profile data..."}):P?e.jsxs("div",{className:"flex justify-center items-center h-64 text-red-500",children:["Error loading profile: ",U.message]}):s?e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(F,{initialValues:V(),validationSchema:O,onSubmit:z,enableReinitialize:!0,children:r=>{var w,v;return e.jsxs($,{className:"flex flex-col gap-3 p-5 bg-white rounded-[20px] border border-lightBlue shadow",autoComplete:"off",children:[e.jsx("p",{className:"text-xl text-darkBlue font-[500] border-b border-b-lightBlue pb-2",children:"Profile Settings"}),e.jsx("div",{className:"",children:e.jsx(ee,{formik:r,name:"imageDataURI",id:"imageDataURI",label:"Profile Image",base64Image:y,setBase64Image:n,backendImage:(w=s==null?void 0:s.user)!=null&&w.image?`${B}/${(v=s==null?void 0:s.user)==null?void 0:v.image}`:s!=null&&s.image?`${B}/${s==null?void 0:s.image}`:""})}),e.jsxs(j,{children:[e.jsx("div",{className:"w-full",children:e.jsx(C,{formik:r,name:"fullName",id:"fullName",label:"Full Name",disabled:!0,hintOn:!0,hintText:"Name can't be edited"})}),e.jsx("div",{className:"w-full",children:e.jsx(C,{formik:r,name:"email",id:"email",label:"Email",disabled:!0,hintOn:!0,hintText:"Email can't be edited"})})]}),e.jsxs(j,{children:[e.jsx("div",{className:"w-full",children:e.jsx(se,{name:"phone",id:"phone",label:"Phone",country:i,disabled:!0,hintOn:!0,hintText:"Phone can't be edited"})}),e.jsx("div",{className:"w-full",children:e.jsx(W,{formik:r,name:"countryName",id:"countryName",label:"Country",getCountryCode:m})})]}),e.jsxs(j,{children:[e.jsx("div",{className:"w-full",children:e.jsx(X,{formik:r,name:"province",id:"province",label:"State/Province",countryName:l,getStateName:a})}),e.jsx("div",{className:"w-full",children:e.jsx(Z,{formik:r,name:"city",id:"city",label:"City",countryName:l,stateName:h})})]}),e.jsx("div",{className:"mt-2",children:e.jsx(A,{formik:r})})]})}})})}):e.jsx("div",{className:"flex justify-center items-center h-64 text-gray-500",children:"No profile data found for this ID."})}_(G);function ae(){const{id:t}=I(),o={password:"",confirmPassword:""},i=q().shape({password:u().required("Current Password is required"),confirmPassword:u().oneOf([Q("password"),null],"Passwords do not match").required("Confirm password is required")}),m=async(l,{resetForm:g})=>{var h;try{const{data:a}=await x.patch(`${N}/update-password/${t}`,l);a!=null&&a.success&&(f.success(((h=a==null?void 0:a.data)==null?void 0:h.message)||(a==null?void 0:a.message)),g())}catch(a){f.error(D(a))}};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(F,{initialValues:o,validationSchema:i,onSubmit:m,enableReinitialize:!0,children:l=>e.jsxs($,{className:"flex flex-col gap-3 p-5 bg-white rounded-[20px] border border-lightBlue shadow",children:[e.jsxs(j,{children:[e.jsx("div",{className:"w-full",children:e.jsx(R,{formik:l,name:"password",id:"password",label:"New Password"})}),e.jsx("div",{className:"w-full",children:e.jsx(R,{formik:l,name:"confirmPassword",id:"confirmPassword",label:"Confirm Password"})})]}),e.jsx("div",{className:"mt-2",children:e.jsx(A,{formik:l})})]})})})})}function ie(){const{id:t}=I(),{data:o,isLoading:i,refetch:m}=S({queryKey:["adminProfit",t],queryFn:async()=>{var n,c;try{const s=await x.get(`${L}/admin-profit/doctor/${t}`);return(c=(n=s==null?void 0:s.data)==null?void 0:n.data)==null?void 0:c.doc}catch(s){if(s.response&&s.response.status===404)return null;throw s}},enabled:!!t}),{data:l,isLoading:g}=S({queryKey:["doctor",t],queryFn:async()=>{var c,s;const n=await x.get(`${N}/${t}`);return(s=(c=n==null?void 0:n.data)==null?void 0:c.data)==null?void 0:s.doc},enabled:!!t}),h={adminProfit:(o==null?void 0:o.adminProfit)||""},a=q().shape({adminProfit:M().typeError("Admin Profit must be a number").positive("Admin Profit must be a positive number").min(0,"Admin Profit cannot be less than 0").max(100,"Admin Profit cannot be more than 100").required("Admin Profit is required")}),y=async n=>{var s;const c=(s=l==null?void 0:l.user)==null?void 0:s._id;if(!c){f.error("Could not find the doctor's user ID.");return}try{const b={user:c,role:"doctor",adminProfit:n.adminProfit},P=await x.post(`${L}/admin-profit`,b);o?f.success("Admin profit updated successfully!"):f.success("Admin profit set successfully!"),console.log(P.data),m()}catch(b){f.error(D(b))}};return i||g?e.jsx("div",{className:"flex justify-center items-center h-64 text-darkBlue",children:"Loading Admin Profit data..."}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(F,{initialValues:h,validationSchema:a,onSubmit:y,enableReinitialize:!0,children:n=>e.jsxs($,{className:"flex flex-col gap-3 p-5 bg-white rounded-[20px] border border-lightBlue shadow",children:[e.jsxs(j,{children:[e.jsx("div",{className:"w-full",children:e.jsx(C,{formik:n,name:"adminProfit",id:"adminProfit",label:"Admin Profit %"})}),e.jsx("div",{className:"w-full"})]}),e.jsx("div",{className:"mt-2",children:e.jsx(A,{formik:n})})]})})})})}function Se(){const[t,o]=p.useState("profile"),i=m=>`cursor-pointer px-4 py-2 rounded-md transition-colors max-[500px]:w-full ${t===m?"bg-myBlue text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsx("div",{className:"",children:e.jsx(Y,{label:"Edit Doctor"})}),e.jsxs("div",{className:"flex items-center gap-5 max-[500px]:flex-col ",children:[e.jsx("button",{type:"button",className:i("profile"),onClick:()=>o("profile"),children:"Profile"}),e.jsx("button",{type:"button",className:i("password"),onClick:()=>o("password"),children:"Change Password"}),e.jsx("button",{type:"button",className:i("admin-profit"),onClick:()=>o("admin-profit"),children:"Set Admin Profit"})]}),e.jsx("div",{children:t==="profile"?e.jsx(te,{}):t==="password"?e.jsx(ae,{}):e.jsx(ie,{})})]})})}export{Se as default};
