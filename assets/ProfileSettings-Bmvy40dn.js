import{r as i,u as R,k as U,V as p,h as b,c as D,a as u,l as A,j as e,F as P,b as q,m as S,E as o,o as h,A as N}from"./index-B1B7tQkZ.js";import{N as V}from"./no-image-icon-CabPHXKl.js";import{B as $}from"./BackButton-CHZgTKcg.js";import"./index-BlONpDat.js";function Y(){const[s,v]=i.useState({}),g=R(),y=["fetch-profile-data"],{data:x,error:d}=U({queryKey:y,queryFn:()=>N.get("/user/my-profile")});i.useEffect(()=>{if(x){const{data:{data:{doc:a}}}=x;v(a)}d&&p.error(b(d))},[x,d]);const C={imageDataURI:null,username:(s==null?void 0:s.username)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||""},[c,m]=i.useState(""),E=D().shape({imageDataURI:A().nullable().test("fileSize","Image size must be less than 4MB",a=>a===null||a instanceof File&&a.size<=4*1024*1024).test("fileFormat","Accepted formats are jpg, png, svg",a=>a===null||a instanceof File&&["image/jpeg","image/png","image/svg+xml"].includes(a.type)).required("Image is required"),username:u().required("Username is required"),email:u().email().required("Email is required"),phone:u().required("Phone is required")}),f=i.useCallback(a=>new Promise((t,r)=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.onerror=r,n.readAsDataURL(a)}),[]),F=i.useCallback(async(a,t)=>{t.setFieldValue("imageDataURI",a.currentTarget.files[0]);const r=a.currentTarget.files[0];if(r){const n=await f(r);m(n)}else m("")},[f]),w=async(a,{setSubmitting:t,resetForm:r})=>{var j;t(!0);const{username:n,email:z,phone:M,...I}=a;try{const{data:l}=await N.patch("/user/update-my-profile-image",{...I,imageDataURI:c});l!=null&&l.success&&(p.success((l==null?void 0:l.message)||((j=l==null?void 0:l.data)==null?void 0:j.message)),await new Promise(B=>setTimeout(B,800)),g("/"),g(0))}catch(l){p.error(b(l))}finally{t(!1),r(),m("")}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center gap-2 justify-between max-[320px]:flex-col",children:[e.jsx("h1",{className:"main-heading",children:"Profile Settings"}),e.jsx($,{})]}),e.jsxs("div",{className:"border border-[#AEC8E2] bg-white rounded-[20px] p-[20px] flex flex-col gap-5",children:[e.jsx("h2",{className:"font-[500] text-[#252C62] text-[20px] pb-[20px] border-b border-b-[#aec8e2]",children:"Profile Information"}),e.jsx(P,{initialValues:C,validationSchema:E,onSubmit:w,enableReinitialize:!0,children:a=>e.jsxs(q,{children:[e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-col gap-5 border border-[#AEC8E2] p-5 rounded-[14px]",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"imageDataURI",className:"block text-[18px] font-[500] text-[#252C62]",children:"Profile Image"}),e.jsxs("div",{className:"mt-1 flex max-[601px]:flex-col max-[601px]:items-start items-center gap-5",children:[e.jsx("div",{className:"relative w-[110px] h-[110px] rounded-[15px] border border-[#AEC8E2] bg-[#F1F5F9] flex items-center justify-center",children:c?e.jsx("img",{src:c,alt:"File Preview",className:"w-full h-full object-cover rounded-[15px]"}):e.jsx("img",{className:`${s!=null&&s.image?"w-full h-full object-cover rounded-[15px]":""}`,src:s!=null&&s.image?`${S}/${s==null?void 0:s.image}`:V,alt:"no image"})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",id:"imageDataURI",name:"imageDataURI",onChange:t=>F(t,a),className:"hidden",form:a}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{htmlFor:"imageDataURI",className:"cursor-pointer font-[500] text-[#202224] text-[16px]",children:"Upload New"}),c&&e.jsx("button",{type:"button",onClick:()=>{a.setFieldValue("image",null),m("")},className:"text-red-500 text-[16px] cursor-pointer",form:a,children:"Remove"})]}),e.jsx("p",{className:"text-[#202224] text-[14px] font-[400]",children:"Your Image should Below 4 MB, Accepted format jpg,png,svg"})]})]})]})]}),e.jsx(o,{name:"imageDataURI",component:"div",className:"text-sm text-red-500"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{htmlFor:"username",className:"flex items-center gap-2 text-sm font-medium text-[#252C62] text-[18px]",children:["Username"," ",e.jsxs("span",{className:"info-span",children:[e.jsx(h,{}),e.jsxs("span",{className:"info-hover",children:[e.jsx("span",{children:"Username can't be changed"}),e.jsx("span",{className:"triangle"})]})]})]}),e.jsx("input",{type:"text",id:"username",name:"username",onChange:a.handleChange,onBlur:a.handleBlur,value:a.values.username,className:"mt-1 block w-full rounded-[6px] px-4 py-2 border border-[#AEC8E2]",form:a,disabled:!0}),e.jsx(o,{name:"username",component:"div",className:"text-sm text-red-500"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{htmlFor:"email",className:"flex items-center gap-2 text-sm font-medium text-[#252C62] text-[18px]",children:["Email"," ",e.jsxs("span",{className:"info-span",children:[e.jsx(h,{}),e.jsxs("span",{className:"info-hover",children:[e.jsx("span",{children:"Email can't be changed"}),e.jsx("span",{className:"triangle"})]})]})]}),e.jsx("input",{type:"email",name:"email",id:"email",onChange:a.handleChange,onBlur:a.handleBlur,value:a.values.email,className:"mt-1 block w-full rounded-[6px] px-4 py-2 border border-[#AEC8E2]",form:a,disabled:!0}),e.jsx(o,{name:"email",component:"div",className:"text-sm text-red-500"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{htmlFor:"phone",className:"flex items-center gap-2 text-sm font-medium text-[#252C62] text-[18px]",children:["Phone"," ",e.jsxs("span",{className:"info-span",children:[e.jsx(h,{}),e.jsxs("span",{className:"info-hover",children:[e.jsx("span",{children:"Phone can't be changed"}),e.jsx("span",{className:"triangle"})]})]})]}),e.jsx("input",{type:"tel",name:"phone",id:"phone",onChange:a.handleChange,onBlur:a.handleBlur,value:a.values.phone,className:"mt-1 block w-full rounded-[6px] px-4 py-2 border border-[#AEC8E2]",form:a,disabled:!0}),e.jsx(o,{name:"phone",component:"div",className:"text-sm text-red-500"})]})]}),e.jsx("div",{className:"flex justify-end gap-3 mt-5",children:e.jsx("button",{type:"submit",className:`${a!=null&&a.isSubmitting?"cursor-not-allowed":"cursor-pointer"} bg-[#4C63BD] inline-flex justify-center rounded-[20px] border border-transparent py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-500`,disabled:a==null?void 0:a.isSubmitting,children:"Save"})})]})})]})]})})}export{Y as default};
