import{D as I,G as Q,r as h,k as S,c as A,I as C,a as m,l as Y,j as s,F as L,b as B,m as R,q as x,S as $,A as b,V as p,h as F,p as _,P as D,Y as M,y as G}from"./index-90C_iGnH.js";import{H as J}from"./HeadingPlusBackBtn-BmGkcs0Z.js";import"./moment-C5S46NFB.js";import{i as W,a as X}from"./index-BZFQK5FB.js";import{g as Z}from"./index-BiCNRH9L.js";import{L as N,U}from"./apiEndpoints-DA67aB0N.js";import{S as k}from"./SingleImageUpload-D-v9muW8.js";import{I as q}from"./Input-NYo6jH4B.js";import{P as ee}from"./PhoneInput-C3xAMeSO.js";import{C as se}from"./CountrySearchInput-NmGWSVL7.js";import{S as te,C as ie}from"./CitySearchInput-DJwWBr5J.js";import{S as re}from"./SelectComponent-oerRb_Cn.js";import{A as ae}from"./AddressInput-CCZMpOW0.js";import"./BackButton-CkQpbmPE.js";import"./index-DN2uC23I.js";import"./index-YtPAdDxb.js";import"./no-image-icon-CabPHXKl.js";import"./index.modern-DR-aB_7J.js";import"./index-nI4YGiSl.js";import"./index-EwOyO1A0.js";function ne(){const{id:i}=I(),l=Q(),[a,c]=h.useState(""),[o,g]=h.useState(""),[f,r]=h.useState(""),[y,n]=h.useState("");h.useEffect(()=>{if(a){const t=new Intl.DisplayNames(["en"],{type:"region"});g(t.of(a))}},[a]);const u=async()=>i?(await b.get(`${N}/${i}`)).data.data.doc:null,{data:e,isLoading:j,isError:P,error:V}=S({queryKey:["lab",i],queryFn:u,enabled:!!i,staleTime:5*60*1e3,cacheTime:30*60*1e3});h.useEffect(()=>{e&&(c(Z(e==null?void 0:e.countryCode)||(e==null?void 0:e.countryCode)||""),r((e==null?void 0:e.province)||""))},[e]);const O=()=>{var t;return{imageDataURI:null,title:(e==null?void 0:e.fullName)||(e==null?void 0:e.title)||((t=e==null?void 0:e.user)==null?void 0:t.username)||"",email:(e==null?void 0:e.email)||"",countryName:(e==null?void 0:e.countryName)||"",province:(e==null?void 0:e.province)||"",city:(e==null?void 0:e.city)||"",phone:(e==null?void 0:e.phone)||"",isLabBranch:`${e!=null&&e.isLabBranch?"yes":"no"}`||"",address:(e==null?void 0:e.address)||"",latitude:e!=null&&e.latitude?Number(e.latitude):null,longitude:e!=null&&e.longitude?Number(e.longitude):null}},T=A().shape({imageDataURI:Y().nullable().test("fileSize","Image size must be less than 4MB",t=>t===null||t instanceof File&&t.size<=4*1024*1024).test("fileFormat","Accepted formats are jpg, png",t=>t===null||t instanceof File&&["image/jpeg","image/png"].includes(t.type)).required("Image is required"),title:m().required("Title is required"),email:m().email("Please enter valid email").required("Email is required"),countryName:m().required("Country Name is required"),province:m().optional(),city:m().optional(),phone:m().test("is-possible-phone","Please enter valid phone number",t=>t?W(t):!0).test("is-valid-phone","Please enter valid phone number",t=>t?X(t):!0).required("Phone is required"),isLabBranch:m().oneOf(["yes","no"],"Please select a valid option").required("Lab Branch selection is required"),address:m().required("Address is required"),latitude:C().nullable(!0).optional(),longitude:C().nullable(!0).optional()}),z=async t=>{var E;const{email:w,phone:v,...K}=t;try{const{data:d}=await b.patch(`${N}/${i}`,{...K,imageDataURI:y,countryCode:a,latitude:String(t==null?void 0:t.latitude),longitude:String(t==null?void 0:t.longitude)});d!=null&&d.success&&(p.success(((E=d==null?void 0:d.data)==null?void 0:E.message)||(d==null?void 0:d.message)),l.invalidateQueries(["doctor",i]))}catch(d){p.error(F(d))}};if(j)return s.jsx("div",{className:"flex justify-center items-center h-64 text-darkBlue",children:"Loading profile data..."});if(P)return s.jsxs("div",{className:"flex justify-center items-center h-64 text-red-500",children:["Error loading profile: ",V.message]});if(!e)return s.jsx("div",{className:"flex justify-center items-center h-64 text-gray-500",children:"No profile data found for this ID."});const H=[{label:"Yes",value:"yes"},{label:"No",value:"no"}];return s.jsx(s.Fragment,{children:s.jsx("div",{className:"",children:s.jsx(L,{initialValues:O(),validationSchema:T,onSubmit:z,enableReinitialize:!0,children:t=>{var w,v;return s.jsxs(B,{className:"flex flex-col gap-3 p-5 bg-white rounded-[20px] border border-lightBlue shadow",autoComplete:"off",children:[s.jsx("p",{className:"text-xl text-darkBlue font-[500] border-b border-b-lightBlue pb-2",children:"Profile Settings"}),s.jsx("div",{className:"",children:s.jsx(k,{formik:t,name:"imageDataURI",id:"imageDataURI",label:"Profile Image",base64Image:y,setBase64Image:n,backendImage:(w=e==null?void 0:e.user)!=null&&w.image?`${R}/${(v=e==null?void 0:e.user)==null?void 0:v.image}`:e!=null&&e.image?`${R}/${e==null?void 0:e.image}`:""})}),s.jsxs(x,{children:[s.jsx("div",{className:"w-full",children:s.jsx(q,{formik:t,name:"title",id:"title",label:"Title",disabled:!0,hintOn:!0,hintText:"Name can't be edited"})}),s.jsx("div",{className:"w-full",children:s.jsx(q,{formik:t,name:"email",id:"email",label:"Email",disabled:!0,hintOn:!0,hintText:"Email can't be edited"})})]}),s.jsxs(x,{children:[s.jsx("div",{className:"w-full",children:s.jsx(ee,{name:"phone",id:"phone",label:"Phone",country:a,disabled:!0,hintOn:!0,hintText:"Phone can't be edited"})}),s.jsx("div",{className:"w-full",children:s.jsx(se,{formik:t,name:"countryName",id:"countryName",label:"Country",getCountryCode:c})})]}),s.jsxs(x,{children:[s.jsx("div",{className:"w-full",children:s.jsx(te,{formik:t,name:"province",id:"province",label:"State/Province",countryName:o,getStateName:r})}),s.jsx("div",{className:"w-full",children:s.jsx(ie,{formik:t,name:"city",id:"city",label:"City",countryName:o,stateName:f})})]}),s.jsxs(x,{children:[s.jsx("div",{className:"w-full",children:s.jsx(ae,{formik:t,lat:e!=null&&e.latitude?Number(e.latitude):null,lng:e!=null&&e.longitude?Number(e.longitude):null})}),s.jsx("div",{className:"w-full",children:s.jsx(re,{formik:t,name:"isLabBranch",id:"isLabBranch",label:"Lab Branch",options:H})})]}),s.jsx("div",{className:"mt-2",children:s.jsx($,{formik:t})})]})}})})})}M(G);function le(){const{id:i}=I(),l={password:"",confirmPassword:""},a=A().shape({password:m().required("Current Password is required"),confirmPassword:m().oneOf([_("password"),null],"Passwords do not match").required("Confirm password is required")}),c=async(o,{resetForm:g})=>{var f;try{const{data:r}=await b.patch(`${N}/update-password/${i}`,o);r!=null&&r.success&&(p.success(((f=r==null?void 0:r.data)==null?void 0:f.message)||(r==null?void 0:r.message)),g())}catch(r){p.error(F(r))}};return s.jsx(s.Fragment,{children:s.jsx("div",{className:"",children:s.jsx(L,{initialValues:l,validationSchema:a,onSubmit:c,enableReinitialize:!0,children:o=>s.jsxs(B,{className:"flex flex-col gap-3 p-5 bg-white rounded-[20px] border border-lightBlue shadow",children:[s.jsxs(x,{children:[s.jsx("div",{className:"w-full",children:s.jsx(D,{formik:o,name:"password",id:"password",label:"New Password"})}),s.jsx("div",{className:"w-full",children:s.jsx(D,{formik:o,name:"confirmPassword",id:"confirmPassword",label:"Confirm Password"})})]}),s.jsx("div",{className:"mt-2",children:s.jsx($,{formik:o})})]})})})})}function oe(){const{id:i}=I(),{data:l,isLoading:a,refetch:c}=S({queryKey:["adminProfitForLab",i],queryFn:async()=>{var n,u;try{const e=await b.get(`${U}/admin-profit/lab/${i}`);return(u=(n=e==null?void 0:e.data)==null?void 0:n.data)==null?void 0:u.doc}catch(e){if(e.response&&e.response.status===404)return null;throw e}},enabled:!!i}),{data:o,isLoading:g}=S({queryKey:["lab",i],queryFn:async()=>{var u,e;const n=await b.get(`${N}/${i}`);return(e=(u=n==null?void 0:n.data)==null?void 0:u.data)==null?void 0:e.doc},enabled:!!i}),f={adminProfit:(l==null?void 0:l.adminProfit)||""},r=A().shape({adminProfit:C().typeError("Admin Profit must be a number").positive("Admin Profit must be a positive number").min(0,"Admin Profit cannot be less than 0").max(100,"Admin Profit cannot be more than 100").required("Admin Profit is required")}),y=async n=>{var e;const u=(e=o==null?void 0:o.user)==null?void 0:e._id;if(!u){p.error("Could not find the lab's user ID.");return}try{const j={user:u,role:"lab",adminProfit:n.adminProfit},P=await b.post(`${U}/admin-profit`,j);l?p.success("Admin profit updated successfully!"):p.success("Admin profit set successfully!"),console.log(P.data),c()}catch(j){p.error(F(j))}};return a||g?s.jsx("div",{className:"flex justify-center items-center h-64 text-darkBlue",children:"Loading Admin Profit data..."}):s.jsx(s.Fragment,{children:s.jsx("div",{className:"",children:s.jsx(L,{initialValues:f,validationSchema:r,onSubmit:y,enableReinitialize:!0,children:n=>s.jsxs(B,{className:"flex flex-col gap-3 p-5 bg-white rounded-[20px] border border-lightBlue shadow",children:[s.jsxs(x,{children:[s.jsx("div",{className:"w-full",children:s.jsx(q,{formik:n,name:"adminProfit",id:"adminProfit",label:"Admin Profit %"})}),s.jsx("div",{className:"w-full"})]}),s.jsx("div",{className:"mt-2",children:s.jsx($,{formik:n})})]})})})})}function Ae(){const[i,l]=h.useState("profile"),a=c=>`cursor-pointer px-4 py-2 rounded-md transition-colors max-[500px]:w-full ${i===c?"bg-myBlue text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`;return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"flex flex-col gap-5",children:[s.jsx("div",{className:"",children:s.jsx(J,{label:"Edit Lab"})}),s.jsxs("div",{className:"flex items-center gap-5 max-[500px]:flex-col ",children:[s.jsx("button",{type:"button",className:a("profile"),onClick:()=>l("profile"),children:"Profile"}),s.jsx("button",{type:"button",className:a("password"),onClick:()=>l("password"),children:"Change Password"}),s.jsx("button",{type:"button",className:a("admin-profit"),onClick:()=>l("admin-profit"),children:"Set Admin Profit"})]}),s.jsx("div",{children:i==="profile"?s.jsx(ne,{}):i==="password"?s.jsx(le,{}):s.jsx(oe,{})})]})})}export{Ae as default};
