import{D as S,r as c,k as w,c as I,a as m,l as O,j as e,F as C,b as q,m as A,q as p,S as F,A as g,p as z,P as $,V as h,h as L,Y,y as H,H as T}from"./index--oTFs3gJ.js";import{H as M}from"./HeadingPlusBackBtn-CCyxk8gb.js";import{h as K}from"./moment-C5S46NFB.js";import{i as _,a as k}from"./index-tNe2wjfG.js";import{g as Q}from"./index-CtnJN3Yv.js";import{L as E,U as B}from"./apiEndpoints-DA67aB0N.js";import{S as G}from"./SingleImageUpload-CsFqmQgm.js";import{I as v}from"./Input-DgXnbsb9.js";import{P as J}from"./PhoneInput-IZNzD7W7.js";import{C as W}from"./CountrySearchInput-DIy4l0Go.js";import{S as X,C as Z}from"./CitySearchInput-CCaZ6Mxn.js";import"./BackButton-BekUZv0_.js";import"./index-CvwiJHFK.js";import"./index-BVp46ldf.js";import"./no-image-icon-CabPHXKl.js";function ee(){const{id:r}=S(),[t,o]=c.useState(""),[d,l]=c.useState(""),[u,x]=c.useState(""),[b,j]=c.useState("");c.useEffect(()=>{if(t){const s=new Intl.DisplayNames(["en"],{type:"region"});l(s.of(t))}},[t]);const n=async()=>r?(await g.get(`${E}/${r}`)).data.data.doc:null,{data:a,isLoading:i,isError:f,error:y}=w({queryKey:["lab",r],queryFn:n,enabled:!!r,staleTime:5*60*1e3,cacheTime:30*60*1e3});c.useEffect(()=>{a&&(o(Q(a==null?void 0:a.countryCode)||(a==null?void 0:a.countryCode)||""),x((a==null?void 0:a.province)||""))},[a]);const D=()=>{var s;return{imageDataURI:null,fullName:(a==null?void 0:a.fullName)||((s=a==null?void 0:a.user)==null?void 0:s.username)||"",email:(a==null?void 0:a.email)||"",countryName:(a==null?void 0:a.countryName)||"",province:(a==null?void 0:a.province)||"",city:(a==null?void 0:a.city)||"",phone:(a==null?void 0:a.phone)||""}},R=I().shape({imageDataURI:O().nullable().test("fileSize","Image size must be less than 4MB",s=>s===null||s instanceof File&&s.size<=4*1024*1024).test("fileFormat","Accepted formats are jpg, png",s=>s===null||s instanceof File&&["image/jpeg","image/png"].includes(s.type)).required("Image is required"),fullName:m().required("Full Name is required"),email:m().email("Please enter valid email").required("Email is required"),countryName:m().required("Country Name is required"),province:m().optional(),city:m().optional(),phone:m().test("is-possible-phone","Please enter valid phone number",s=>s?_(s):!0).test("is-valid-phone","Please enter valid phone number",s=>s?k(s):!0).required("Phone is required")}),U=async s=>{const{fullName:N,email:P,phone:re,...V}=s;console.log({...V,imageDataURI:b,dateOfBirth:K(s==null?void 0:s.dateOfBirth).format("YYYY-MM-DD"),countryCode:t,doctorId:r})};return i?e.jsx("div",{className:"flex justify-center items-center h-64 text-darkBlue",children:"Loading profile data..."}):f?e.jsxs("div",{className:"flex justify-center items-center h-64 text-red-500",children:["Error loading profile: ",y.message]}):a?e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(C,{initialValues:D(),validationSchema:R,onSubmit:U,enableReinitialize:!0,children:s=>{var N,P;return e.jsxs(q,{className:"flex flex-col gap-3 p-5 bg-white rounded-[20px] border border-lightBlue shadow",autoComplete:"off",children:[e.jsx("p",{className:"text-xl text-darkBlue font-[500] border-b border-b-lightBlue pb-2",children:"Profile Settings"}),e.jsx("div",{className:"",children:e.jsx(G,{formik:s,name:"imageDataURI",id:"imageDataURI",label:"Profile Image",base64Image:b,setBase64Image:j,backendImage:(N=a==null?void 0:a.user)!=null&&N.image?`${A}/${(P=a==null?void 0:a.user)==null?void 0:P.image}`:a!=null&&a.image?`${A}/${a==null?void 0:a.image}`:""})}),e.jsxs(p,{children:[e.jsx("div",{className:"w-full",children:e.jsx(v,{formik:s,name:"fullName",id:"fullName",label:"Full Name",disabled:!0,hintOn:!0,hintText:"Name can't be edited"})}),e.jsx("div",{className:"w-full",children:e.jsx(v,{formik:s,name:"email",id:"email",label:"Email",disabled:!0,hintOn:!0,hintText:"Email can't be edited"})})]}),e.jsxs(p,{children:[e.jsx("div",{className:"w-full",children:e.jsx(J,{name:"phone",id:"phone",label:"Phone",country:t,disabled:!0,hintOn:!0,hintText:"Phone can't be edited"})}),e.jsx("div",{className:"w-full",children:e.jsx(W,{formik:s,name:"countryName",id:"countryName",label:"Country",getCountryCode:o})})]}),e.jsxs(p,{children:[e.jsx("div",{className:"w-full",children:e.jsx(X,{formik:s,name:"province",id:"province",label:"State/Province",countryName:d,getStateName:x})}),e.jsx("div",{className:"w-full",children:e.jsx(Z,{formik:s,name:"city",id:"city",label:"City",countryName:d,stateName:u})})]}),e.jsx("div",{className:"mt-2",children:e.jsx(F,{formik:s})})]})}})})}):e.jsx("div",{className:"flex justify-center items-center h-64 text-gray-500",children:"No profile data found for this ID."})}Y(H);function ae(){const{id:r}=S(),t={newPassword:"",confirmPassword:""},o=I().shape({newPassword:m().password().required("New Password is required"),confirmPassword:m().oneOf([z("newPassword"),null],"Passwords do not match").required("Confirm password is required")}),d=async l=>{try{console.log({...l,doctorId:r})}catch(u){h.error(L(u))}};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(C,{initialValues:t,validationSchema:o,onSubmit:d,enableReinitialize:!0,children:l=>e.jsxs(q,{className:"flex flex-col gap-3 p-5 bg-white rounded-[20px] border border-lightBlue shadow",children:[e.jsxs(p,{children:[e.jsx("div",{className:"w-full",children:e.jsx($,{formik:l,name:"newPassword",id:"newPassword",label:"New Password"})}),e.jsx("div",{className:"w-full",children:e.jsx($,{formik:l,name:"confirmPassword",id:"confirmPassword",label:"Confirm Password"})})]}),e.jsx("div",{className:"mt-2",children:e.jsx(F,{formik:l})})]})})})})}function se(){const{id:r}=S(),{data:t,isLoading:o,refetch:d}=w({queryKey:["adminProfitForLab",r],queryFn:async()=>{var n,a;try{const i=await g.get(`${B}/admin-profit/lab/${r}`);return(a=(n=i==null?void 0:i.data)==null?void 0:n.data)==null?void 0:a.doc}catch(i){if(i.response&&i.response.status===404)return null;throw i}},enabled:!!r}),{data:l,isLoading:u}=w({queryKey:["lab",r],queryFn:async()=>{var a,i;const n=await g.get(`${E}/${r}`);return(i=(a=n==null?void 0:n.data)==null?void 0:a.data)==null?void 0:i.doc},enabled:!!r}),x={adminProfit:(t==null?void 0:t.adminProfit)||""},b=I().shape({adminProfit:T().typeError("Admin Profit must be a number").positive("Admin Profit must be a positive number").min(0,"Admin Profit cannot be less than 0").max(100,"Admin Profit cannot be more than 100").required("Admin Profit is required")}),j=async n=>{var i;const a=(i=l==null?void 0:l.user)==null?void 0:i._id;if(!a){h.error("Could not find the lab's user ID.");return}try{const f={user:a,role:"lab",adminProfit:n.adminProfit},y=await g.post(`${B}/admin-profit`,f);t?h.success("Admin profit updated successfully!"):h.success("Admin profit set successfully!"),console.log(y.data),d()}catch(f){h.error(L(f))}};return o||u?e.jsx("div",{className:"flex justify-center items-center h-64 text-darkBlue",children:"Loading Admin Profit data..."}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsx(C,{initialValues:x,validationSchema:b,onSubmit:j,enableReinitialize:!0,children:n=>e.jsxs(q,{className:"flex flex-col gap-3 p-5 bg-white rounded-[20px] border border-lightBlue shadow",children:[e.jsxs(p,{children:[e.jsx("div",{className:"w-full",children:e.jsx(v,{formik:n,name:"adminProfit",id:"adminProfit",label:"Admin Profit %"})}),e.jsx("div",{className:"w-full"})]}),e.jsx("div",{className:"mt-2",children:e.jsx(F,{formik:n})})]})})})})}function je(){const[r,t]=c.useState("profile"),o=d=>`cursor-pointer px-4 py-2 rounded-md transition-colors max-[500px]:w-full ${r===d?"bg-myBlue text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsx("div",{className:"",children:e.jsx(M,{label:"Edit Lab"})}),e.jsxs("div",{className:"flex items-center gap-5 max-[500px]:flex-col ",children:[e.jsx("button",{type:"button",className:o("profile"),onClick:()=>t("profile"),children:"Profile"}),e.jsx("button",{type:"button",className:o("password"),onClick:()=>t("password"),children:"Change Password"}),e.jsx("button",{type:"button",className:o("admin-profit"),onClick:()=>t("admin-profit"),children:"Set Admin Profit"})]}),e.jsx("div",{children:r==="profile"?e.jsx(ee,{}):r==="password"?e.jsx(ae,{}):e.jsx(se,{})})]})})}export{je as default};
