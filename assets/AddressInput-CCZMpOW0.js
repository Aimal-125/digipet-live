import{r as a,j as e,E as S}from"./index-90C_iGnH.js";import"./CitySearchInput-DJwWBr5J.js";import{u as k,A as I,M as G,a as F,b as R,C as $,c as D,d as _}from"./index.modern-DR-aB_7J.js";import{I as B}from"./index-EwOyO1A0.js";function K({formik:o,label:n="Address",lat:i=null,lng:c=null}){const[m,p]=a.useState(!1),[d,u]=a.useState(null),[b,g]=a.useState(null),[h,y]=a.useState(!1),[x,j]=a.useState(!1),[f,E]=a.useState(null),[L,q]=k(),C="AIzaSyDIBfIEiwZqaEBV1N2DbCogGhHLfsyhR6c",w=a.useCallback(()=>{const s={lat:40.7128,lng:-74.006};return new Promise(t=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(l=>{const r={lat:l.coords.latitude,lng:l.coords.longitude};u(r),g(r),t(r)},l=>{console.error("Geolocation error:",l),u(s),g(s),alert("Could not retrieve your location. Using a default location."),t(s)}):(u(s),g(s),alert("Geolocation is not supported by your browser. Using a default location."),t(s))})},[u,g]);a.useEffect(()=>{(async()=>{if(y(!0),i&&c){const t={lat:i,lng:c};u(t),g(t)}else await w();y(!1)})()},[w,i,c]);const P=async(s,t)=>{if(!s||!t)return console.error("Invalid coordinates for geocoding"),"Could not determine address";j(!0);try{const l=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${s},${t}&key=${C}`);if(!l.ok)throw new Error(`Geocoding API request failed: ${l.statusText}`);const r=await l.json();if(r.status==="OK"&&r.results&&r.results.length>0){const A=r.results[0].formatted_address;return console.log("Geocoding result:",A),j(!1),A}else return console.error("Geocoding failed:",r.status,r.error_message),j(!1),`Address not found (${r.status})`}catch(l){return console.error("Error during geocoding fetch:",l),j(!1),"Geocoding request failed"}},v=s=>{s.target.classList.contains("address-input-modal")&&p(!1)},M=a.useCallback(s=>{if(s.latLng){const t={lat:s.latLng.lat(),lng:s.latLng.lng()};console.log("Marker dragged to:",t),u(t)}},[]),N=async()=>{if(d){const s=await P(d.lat,d.lng);o.setFieldValue("address",s),o.setFieldValue("latitude",d.lat),o.setFieldValue("longitude",d.lng),p(!1)}else alert("Please select a location on the map first.")};return a.useEffect(()=>{var s;if(f&&((s=f.geometry)!=null&&s.location)){const t={lat:f.geometry.location.lat(),lng:f.geometry.location.lng()};u(t),g(t)}},[f]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{htmlFor:"address",className:"block text-[18px] font-[500] text-[#252C62]",children:n}),e.jsx("input",{className:`${h?"cursor-wait":"cursor-pointer"} border border-[#AEC8E2] rounded-[6px] px-4 py-2 w-full`,type:"text",name:"address",id:"address",placeholder:h?"Loading Map...":"Select Address",value:o.values.address,readOnly:!0,onClick:async()=>{h||x||(p(!0),y(!1),await w(),y(!1))},disabled:h||x}),e.jsx(S,{name:"address",component:"div",className:"text-sm text-red-500"})]}),m&&e.jsx("div",{className:"address-input-modal",onClick:v,children:e.jsxs("div",{className:"address-map-container",children:[e.jsxs("div",{className:"address-map",children:[b&&d&&e.jsxs(I,{apiKey:C,children:[e.jsx(G,{mapId:"address-map",defaultCenter:b,defaultZoom:16,gestureHandling:"greedy",children:e.jsx(F,{ref:L,position:d,draggable:!0,onDragEnd:M})}),e.jsx(R,{position:$.LEFT_TOP,children:e.jsx("div",{className:"ml-[10px]",children:e.jsx(V,{onPlaceSelect:E})})}),e.jsx(O,{place:f})]}),!b&&!d&&e.jsx("p",{children:"Loading map..."})]}),e.jsxs("div",{className:"flex items-center justify-end gap-5 mt-4",children:[e.jsx("div",{children:e.jsx("button",{type:"button",className:"px-4 py-2 rounded-[8px] bg-[#4C63BD] text-white cursor-pointer disabled:opacity-50",onClick:N,disabled:!d||x,children:x?"Loading...":"Select Address"})}),e.jsx("div",{children:e.jsx("button",{type:"button",className:"px-4 py-2 rounded-[8px] bg-white border border-[#AEC8E2] cursor-pointer",onClick:()=>{p(!1)},disabled:x,children:"Cancel"})})]})]})})]})}const O=({place:o})=>{const n=_();return a.useEffect(()=>{var i;!n||!o||!((i=o.geometry)!=null&&i.viewport)||n.fitBounds(o.geometry.viewport)},[n,o]),null},V=({onPlaceSelect:o})=>{const[n,i]=a.useState(null),c=a.useRef(null),m=D("places");return a.useEffect(()=>{if(!m||!c.current)return;const p={fields:["geometry","name","formatted_address"]};i(new m.Autocomplete(c.current,p))},[m]),a.useEffect(()=>{n&&n.addListener("place_changed",()=>{o(n.getPlace())})},[o,n]),e.jsxs("div",{className:"flex items-center border border-gray-300 bg-white text-black rounded-[20px]",children:[e.jsx("span",{className:"pl-2 text-gray-500",children:e.jsx(B,{})}),e.jsx("input",{ref:c,className:"w-[175px] py-2 px-2 outline-none",type:"search",name:"search",id:"search","aria-label":"Search",placeholder:"Search"})]})};export{K as A};
