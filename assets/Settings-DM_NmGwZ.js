var $=a=>{throw TypeError(a)};var q=(a,t,e)=>t.has(a)||$("Cannot "+e);var i=(a,t,e)=>(q(a,t,"read from private field"),e?e.call(a):t.get(a)),g=(a,t,e)=>t.has(a)?$("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e),v=(a,t,e,r)=>(q(a,t,"write to private field"),r?r.call(a,e):t.set(a,e),e),y=(a,t,e)=>(q(a,t,"access private method"),e);import{ad as Z,ae as tt,af as B,ag as et,ah as D,W as X,r as A,ai as st,aj as rt,k as at,c as it,X as Q,a as L,j as s,h as M,F as nt,b as ot,q as O,S as lt,V as S,A as T}from"./index-DUYjTDLa.js";import{m as ut,p as ht,i as mt,a as pt}from"./index-BP6acCge.js";import{P as ct}from"./PhoneInput-BkFSDEwC.js";import{I as F}from"./Input-8IAiboUU.js";import{b as U}from"./apiEndpoints-DoVdz8rY.js";import{I as dt,a as ft}from"./IsError-CddUd3sL.js";import{H as bt}from"./HeadingPlusBackBtn-FVXhAHzt.js";import"./index-ucCudfBO.js";/* empty css                */import"./BackButton-HT3sDUP7.js";import"./index-RjsA-lLy.js";var c,d,o,u,h,E,I,z,xt=(z=class extends Z{constructor(t,e){super();g(this,h);g(this,c);g(this,d);g(this,o);g(this,u);v(this,c,t),this.setOptions(e),this.bindMethods(),y(this,h,E).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const e=this.options;this.options=i(this,c).defaultMutationOptions(t),tt(this.options,e)||i(this,c).getMutationCache().notify({type:"observerOptionsUpdated",mutation:i(this,o),observer:this}),e!=null&&e.mutationKey&&this.options.mutationKey&&B(e.mutationKey)!==B(this.options.mutationKey)?this.reset():((r=i(this,o))==null?void 0:r.state.status)==="pending"&&i(this,o).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=i(this,o))==null||t.removeObserver(this)}onMutationUpdate(t){y(this,h,E).call(this),y(this,h,I).call(this,t)}getCurrentResult(){return i(this,d)}reset(){var t;(t=i(this,o))==null||t.removeObserver(this),v(this,o,void 0),y(this,h,E).call(this),y(this,h,I).call(this)}mutate(t,e){var r;return v(this,u,e),(r=i(this,o))==null||r.removeObserver(this),v(this,o,i(this,c).getMutationCache().build(i(this,c),this.options)),i(this,o).addObserver(this),i(this,o).execute(t)}},c=new WeakMap,d=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakSet,E=function(){var e;const t=((e=i(this,o))==null?void 0:e.state)??et();v(this,d,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},I=function(t){D.batch(()=>{var e,r,l,f,m,b,j,w;if(i(this,u)&&this.hasListeners()){const p=i(this,d).variables,x=i(this,d).context;(t==null?void 0:t.type)==="success"?((r=(e=i(this,u)).onSuccess)==null||r.call(e,t.data,p,x),(f=(l=i(this,u)).onSettled)==null||f.call(l,t.data,null,p,x)):(t==null?void 0:t.type)==="error"&&((b=(m=i(this,u)).onError)==null||b.call(m,t.error,p,x),(w=(j=i(this,u)).onSettled)==null||w.call(j,void 0,t.error,p,x))}this.listeners.forEach(p=>{p(i(this,d))})})},z);function Pt(a,t){const e=X(),[r]=A.useState(()=>new xt(e,a));A.useEffect(()=>{r.setOptions(a)},[r,a]);const l=A.useSyncExternalStore(A.useCallback(m=>r.subscribe(D.batchCalls(m)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),f=A.useCallback((m,b)=>{r.mutate(m,b).catch(st)},[r]);if(l.error&&rt(r.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:f,mutateAsync:l.mutate}}function gt(a,t){var e=Array.prototype.slice.call(t);return e.push(ut),a.apply(this,e)}function H(){return gt(ht,arguments)}function Mt(){var G,R,K,V;const[a,t]=A.useState(""),e=X(),r={contactEmail:"",whatsAppGroupLink:"",whatsAppPhone:"",adminProfit:"",platformFee:""},{data:l,isLoading:f,isError:m,error:b}=at({queryKey:["settings"],queryFn:async()=>(await T.get(U)).data}),j=Pt({mutationFn:async n=>(await T.post(U,n)).data,onSuccess:()=>{S.success("Settings updated successfully!"),e.invalidateQueries({queryKey:["settings"]})},onError:n=>{S.error(M(n))}}),w=it().shape({contactEmail:L().email("Please enter valid email").required("Required"),whatsAppGroupLink:L().url("Please enter valid url").optional(),whatsAppPhone:L().test("is-possible-phone","Please enter valid phone number",n=>n?mt(n):!0).test("is-valid-phone","Please enter valid phone number",n=>n?pt(n):!0).required("Whatsapp Phone Number is required"),adminProfit:Q().typeError("Admin Profit must be a number").positive("Admin Profit must be a positive number").min(0,"Admin Profit cannot be less than 0").max(100,"Admin Profit cannot be more than 100").required("Admin Profit is required"),platformFee:Q().typeError("Platform Fee must be a number").positive("Platform Fee must be a positive number").min(0,"Platform Fee cannot be less than 0").max(100,"Platform Fee cannot be more than 100").required("Platform Fee is required")}),p=async n=>{try{const P={...n,adminProfit:parseFloat(n.adminProfit),platformFee:parseFloat(n.platformFee)},W=H(P.whatsAppPhone);if(W)P.whatsAppPhone=W.number;else{S.error("Invalid WhatsApp Phone Number format.");return}await j.mutateAsync(P)}catch(P){S.error(M(P))}};if(f)return s.jsxs("div",{className:"flex flex-col gap-5",children:[s.jsx("h1",{className:"main-heading",children:"Settings"}),s.jsx(dt,{})]});if(m)return s.jsxs("div",{className:"flex flex-col gap-5",children:[s.jsx("h1",{className:"main-heading",children:"Settings"}),s.jsx(ft,{message:M(b)})]});const{contactEmail:x,whatsAppGroupLink:_,whatsAppPhone:k,adminProfit:N,platformFee:C}=((G=l==null?void 0:l.data)==null?void 0:G.settings)||{},J=k&&((R=H(`+${k}`))==null?void 0:R.number)||"",Y={...r,contactEmail:x||r.contactEmail,whatsAppGroupLink:_||r.whatsAppGroupLink,whatsAppPhone:J||r.whatsAppPhone,adminProfit:N!=null?String((K=parseFloat(N))==null?void 0:K.toFixed(2)):r.adminProfit,platformFee:C!=null?String((V=parseFloat(C))==null?void 0:V.toFixed(2)):r.platformFee};return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"flex flex-col gap-5",children:[s.jsx("div",{className:"",children:s.jsx(bt,{label:"Settings"})}),s.jsx("div",{className:"rounded-[20px] bg-white p-5",children:s.jsx(nt,{initialValues:Y,validationSchema:w,onSubmit:p,enableReinitialize:!0,children:n=>s.jsxs(ot,{className:"flex flex-col gap-3",children:[s.jsxs(O,{children:[s.jsx("div",{className:"w-full",children:s.jsx(F,{formik:n,name:"whatsAppGroupLink",id:"whatsAppGroupLink",label:"WhatsApp Group Link"})}),s.jsx("div",{className:"w-full",children:s.jsx(ct,{name:"whatsAppPhone",id:"whatsAppPhone",label:"WhatsApp Phone",country:a})})]}),s.jsxs(O,{children:[s.jsx("div",{className:"w-full",children:s.jsx(F,{formik:n,name:"contactEmail",id:"contactEmail",label:"Contact Email"})}),s.jsx("div",{className:"w-full",children:s.jsx(F,{formik:n,name:"adminProfit",id:"adminProfit",label:"Admin Profit %"})})]}),s.jsx(O,{children:s.jsx("div",{className:"w-full",children:s.jsx(F,{formik:n,name:"platformFee",id:"platformFee",label:"Platform Fee %"})})}),s.jsx("div",{className:"mt-2",children:s.jsx(lt,{formik:n,label:j.isPending?"Saving...":"Save"})})]})})})]})})}export{Mt as default};
