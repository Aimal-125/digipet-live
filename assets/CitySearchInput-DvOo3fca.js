import{r as l,j as n,E as M}from"./index-DqT0A0WV.js";import{u as O,A as k,M as G,a as U,b as B,C as K,c as _,d as H}from"./index.modern-ckVtXl3t.js";import{I as z}from"./index-D5TUXJLt.js";function X({formik:o,label:r="Address"}){const[j,C]=l.useState(!1),[a,g]=l.useState(null),[v,u]=l.useState(null),[h,y]=l.useState(!1),[f,d]=l.useState(!1),[i,m]=l.useState(null),[x,S]=O(),b="AIzaSyDIBfIEiwZqaEBV1N2DbCogGhHLfsyhR6c",p={lat:40.7128,lng:-74.006},L=()=>new Promise(t=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{const e={lat:s.coords.latitude,lng:s.coords.longitude};g(e),u(e),t(e)},s=>{console.error("Geolocation error:",s),g(p),u(p),alert("Could not retrieve your location. Using a default location."),t(p)}):(g(p),u(p),alert("Geolocation is not supported by your browser. Using a default location."),t(p))}),E=async(t,s)=>{if(!t||!s)return console.error("Invalid coordinates for geocoding"),"Could not determine address";d(!0);try{const e=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${t},${s}&key=${b}`);if(!e.ok)throw new Error(`Geocoding API request failed: ${e.statusText}`);const c=await e.json();if(c.status==="OK"&&c.results&&c.results.length>0){const w=c.results[0].formatted_address;return console.log("Geocoding result:",w),d(!1),w}else return console.error("Geocoding failed:",c.status,c.error_message),d(!1),`Address not found (${c.status})`}catch(e){return console.error("Error during geocoding fetch:",e),d(!1),"Geocoding request failed"}},A=t=>{t.target.classList.contains("address-input-modal")&&C(!1)},$=l.useCallback(t=>{if(t.latLng){const s={lat:t.latLng.lat(),lng:t.latLng.lng()};console.log("Marker dragged to:",s),g(s)}},[]),T=async()=>{if(a){const t=await E(a.lat,a.lng);o.setFieldValue("address",t),C(!1)}else alert("Please select a location on the map first.")};return l.useEffect(()=>{var t;if(i&&((t=i.geometry)!=null&&t.location)){const s={lat:i.geometry.location.lat(),lng:i.geometry.location.lng()};g(s),u(s)}},[i]),l.useEffect(()=>{var t;if(i&&((t=i.geometry)!=null&&t.location)){const s={lat:i.geometry.location.lat(),lng:i.geometry.location.lng()};g(s),u(s)}},[i]),n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsx("label",{htmlFor:"address",className:"block text-[18px] font-[500] text-[#252C62]",children:r}),n.jsx("input",{className:`${h?"cursor-wait":"cursor-pointer"} border border-[#AEC8E2] rounded-[6px] px-4 py-2 w-full`,type:"text",name:"address",id:"address",placeholder:h?"Loading Map...":"Select Address",value:o.values.address,readOnly:!0,onClick:async()=>{h||f||(C(!0),y(!1),await L(),y(!1))},disabled:h||f}),n.jsx(M,{name:"address",component:"div",className:"text-sm text-red-500"})]}),j&&n.jsx("div",{className:"address-input-modal",onClick:A,children:n.jsxs("div",{className:"address-map-container",children:[n.jsxs("div",{className:"address-map",children:[v&&a&&n.jsxs(k,{apiKey:b,children:[n.jsx(G,{mapId:"address-map",defaultCenter:v,defaultZoom:16,gestureHandling:"greedy",children:n.jsx(U,{ref:x,position:a,draggable:!0,onDragEnd:$})}),n.jsx(B,{position:K.LEFT_TOP,children:n.jsx("div",{className:"ml-[10px]",children:n.jsx(J,{onPlaceSelect:m})})}),n.jsx(q,{place:i})]}),!v&&!a&&n.jsx("p",{children:"Loading map..."})]}),n.jsxs("div",{className:"flex items-center justify-end gap-5 mt-4",children:[" ",n.jsx("div",{children:n.jsx("button",{type:"button",className:"px-4 py-2 rounded-[8px] bg-[#4C63BD] text-white cursor-pointer disabled:opacity-50",onClick:T,disabled:!a||f,children:f?"Loading...":"Select Address"})}),n.jsx("div",{children:n.jsx("button",{type:"button",className:"px-4 py-2 rounded-[8px] bg-white border border-[#AEC8E2] cursor-pointer",onClick:()=>{C(!1)},disabled:f,children:"Cancel"})})]})]})})]})}const q=({place:o})=>{const r=H();return l.useEffect(()=>{var j;!r||!o||!((j=o.geometry)!=null&&j.viewport)||r.fitBounds(o.geometry.viewport)},[r,o]),null},J=({onPlaceSelect:o})=>{const[r,j]=l.useState(null),C=l.useRef(null),a=_("places");return l.useEffect(()=>{if(!a||!C.current)return;const g={fields:["geometry","name","formatted_address"]};j(new a.Autocomplete(C.current,g))},[a]),l.useEffect(()=>{r&&r.addListener("place_changed",()=>{o(r.getPlace())})},[o,r]),n.jsxs("div",{className:"flex items-center border border-gray-300 bg-white text-black rounded-[20px]",children:[n.jsx("span",{className:"pl-2 text-gray-500",children:n.jsx(z,{})}),n.jsx("input",{ref:C,className:"w-[175px] py-2 px-2 outline-none",type:"search",name:"search",id:"search","aria-label":"Search",placeholder:"Search"})]})},I={},Y=({formik:o,name:r="",id:j="",label:C="",countryName:a="",getStateName:g=()=>{}})=>{const[v,u]=l.useState(""),[h,y]=l.useState([]),[f,d]=l.useState([]),[i,m]=l.useState(!1),[x,S]=l.useState(-1),[b,p]=l.useState(!1),L=l.useRef(null),E=l.useRef(null);l.useEffect(()=>{(async()=>{if(!a){y([]),d([]),u(""),p(!1);return}if(I[a]){if(console.log(`Using states for ${a} from cache.`),y(I[a]),v){const e=I[a].filter(c=>c.name.toLowerCase().includes(v.toLowerCase()));d(e)}else d([]);const s=o.values[r];u(s||""),p(!1);return}console.log(`Fetching states for ${a} from API.`),p(!0),y([]),d([]);try{const s=await fetch("https://countriesnow.space/api/v0.1/countries/states",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({country:a})});if(!s.ok){console.error(`HTTP error fetching states: ${s.status}`),y([]),d([]),I[a]=[];return}const e=await s.json();e.error||!e.data||!e.data.states?e.data&&e.data.states?(y(e.data.states),I[a]=e.data.states):(console.error("API error fetching states:",e.msg||"Unexpected API response structure"),y([]),d([]),I[a]=[]):(y(e.data.states),I[a]=e.data.states)}catch(s){console.error("Error fetching states:",s),y([]),d([]),I[a]=[]}finally{p(!1);const s=o.values[r];u(s||"")}})()},[a,o.values,v,r]),l.useEffect(()=>{const t=o.values[r];typeof t=="string"?u(t):t||u("")},[o.values,r]);const A=t=>{const s=t.target.value;if(u(s),S(-1),s.length>0&&h.length>0){const e=h.filter(c=>c.name.toLowerCase().includes(s.toLowerCase()));d(e),m(!0)}else d([]),m(!1)},$=t=>{u(t.name),o.setFieldValue(r,t.name),g(t.name),d([]),m(!1),S(-1),o.setFieldTouched(r,!0)},T=t=>{!i||f.length===0||(t.key==="ArrowUp"?(t.preventDefault(),S(s=>s<=0?f.length-1:s-1)):t.key==="ArrowDown"?(t.preventDefault(),S(s=>s===f.length-1?0:s+1)):t.key==="Enter"?(t.preventDefault(),x>=0&&x<f.length&&$(f[x])):t.key==="Escape"&&(m(!1),S(-1),o.setFieldTouched(r,!0)))};return l.useEffect(()=>{const t=s=>{L.current&&!L.current.contains(s.target)&&E.current&&!E.current.contains(s.target)&&(m(!1),S(-1),o.setFieldTouched(r,!0))};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[o,r]),l.useEffect(()=>{if(x!==-1&&E.current){const t=E.current.children[x];t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}},[x,f.length]),n.jsxs("div",{className:"relative flex flex-col gap-3",children:[C&&n.jsx("label",{htmlFor:j,className:"block text-[18px] font-[500] text-[#252C62]",children:C}),n.jsx("input",{ref:L,type:"text",id:j,name:r,value:o==null?void 0:o.values[r],onChange:t=>{o.handleChange(t),A(t)},onKeyDown:T,onFocus:()=>{if(a&&h.length>0){if(v.length>0){const t=h.filter(s=>s.name.toLowerCase().includes(v.toLowerCase()));d(t)}else d(h);m(!0)}},onBlur:t=>{o.handleBlur(t),setTimeout(()=>{m(!1),S(-1)},100)},placeholder:b&&a?"Loading...":a?"Search for a state or province...":"Select a country first...",disabled:!a||b,className:`border border-[#AEC8E2] rounded-[6px] px-4 py-2 w-full ${!a||b?"bg-gray-100 cursor-not-allowed":""}`}),i&&f.length>0&&n.jsx("ul",{ref:E,className:"absolute left-0 top-[100%] z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-60 overflow-y-auto shadow-lg",children:f.map((t,s)=>n.jsx("li",{className:`px-4 py-2 cursor-pointer ${s===x?"bg-blue-100":"hover:bg-gray-100"}`,onClick:()=>$(t),onMouseDown:e=>e.preventDefault(),children:t.name},t.code||t.name||s))}),i&&f.length===0&&v.length>0&&!b&&n.jsx("div",{className:"absolute left-0 top-[100%] z-10 w-full bg-white border border-gray-300 rounded-md mt-1 px-4 py-2 text-gray-600 shadow-lg",children:"No matching states found."}),n.jsx(M,{name:r,component:"div",className:"text-red-500 text-sm mt-1"})]})},D={},N=({formik:o,name:r="",id:j="",label:C="",countryName:a="",stateName:g="",getCityName:v=()=>{}})=>{const[u,h]=l.useState(""),[y,f]=l.useState([]),[d,i]=l.useState([]),[m,x]=l.useState(!1),[S,b]=l.useState(-1),[p,L]=l.useState(!1),E=l.useRef(null),A=l.useRef(null);l.useEffect(()=>{(async()=>{if(!a||!g){f([]),i([]),h(""),L(!1);return}const c=`${a}_${g}`;if(D[c]){if(console.log(`Using cities for ${a}, ${g} from cache.`),f(D[c]),u){const P=D[c].filter(F=>F.toLowerCase().includes(u.toLowerCase()));i(P)}else i([]);const w=o.values[r];h(w||""),L(!1);return}console.log(`Fetching cities for ${a}, ${g} from API.`),L(!0),f([]),i([]);try{const w=await fetch("https://countriesnow.space/api/v0.1/countries/state/cities",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({country:a,state:g})});if(!w.ok){console.error(`HTTP error fetching cities: ${w.status}`),f([]),i([]),D[c]=[];return}const P=await w.json();if(P.error||!P.data)console.error("API error fetching cities:",P.msg||"Unexpected API response structure or no cities found"),f([]),i([]),D[c]=[];else{const F=P.data||[];if(f(F),D[c]=F,u){const V=F.filter(R=>R.toLowerCase().includes(u.toLowerCase()));i(V)}else i([])}}catch(w){console.error("Error fetching cities:",w),f([]),i([]),D[c]=[]}finally{L(!1);const w=o.values[r];h(w||"")}})()},[a,g,o.values,u,r]),l.useEffect(()=>{const e=o.values[r];typeof e=="string"?h(e):e||h("")},[o.values,r]);const $=e=>{const c=e.target.value;if(h(c),b(-1),c.length>0&&y.length>0){const w=y.filter(P=>P.toLowerCase().includes(c.toLowerCase()));i(w),x(!0)}else i([]),x(!1)},T=e=>{h(e),o.setFieldValue(r,e),i([]),x(!1),b(-1),o.setFieldTouched(r,!0),typeof v=="function"&&v(e)},t=e=>{!m||d.length===0||(e.key==="ArrowUp"?(e.preventDefault(),b(c=>c<=0?d.length-1:c-1)):e.key==="ArrowDown"?(e.preventDefault(),b(c=>c===d.length-1?0:c+1)):e.key==="Enter"?(e.preventDefault(),S>=0&&S<d.length&&T(d[S])):e.key==="Escape"&&(x(!1),b(-1),o.setFieldTouched(r,!0)))};l.useEffect(()=>{const e=c=>{E.current&&!E.current.contains(c.target)&&A.current&&!A.current.contains(c.target)&&(x(!1),b(-1),o.setFieldTouched(r,!0))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[o,r]),l.useEffect(()=>{if(S!==-1&&A.current){const e=A.current.children[S];e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})}},[S,d.length]);const s=!a||!g||p;return n.jsxs("div",{className:"relative flex flex-col gap-3",children:[C&&n.jsx("label",{htmlFor:j,className:"block text-[18px] font-[500] text-[#252C62]",children:C}),n.jsx("input",{ref:E,type:"text",id:j,name:r,value:o==null?void 0:o.values[r],onChange:e=>{o.handleChange(e),$(e)},onKeyDown:t,onFocus:()=>{if(a&&g&&y.length>0){const e=y.filter(c=>c.toLowerCase().includes(u.toLowerCase()));i(e),x(!0)}else a&&g&&!p&&(i([]),x(!0))},onBlur:e=>{o.handleBlur(e),setTimeout(()=>{x(!1),b(-1)},100)},placeholder:p?"Loading cities...":a?g?"Search for a city...":"Select a state/province first...":"Select a country first...",disabled:s,className:`border border-[#AEC8E2] rounded-[6px] px-4 py-2 w-full ${s?"bg-gray-100 cursor-not-allowed":""}`}),m&&(d.length>0||u.length>0&&!p||p)&&n.jsx("ul",{ref:A,className:"absolute left-0 top-[100%] z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-60 overflow-y-auto shadow-lg",children:p&&u.length===0?n.jsx("li",{className:"px-4 py-2 text-gray-600",children:"Loading cities..."}):d.length>0?d.map((e,c)=>n.jsx("li",{className:`px-4 py-2 cursor-pointer ${c===S?"bg-blue-100":"hover:bg-gray-100"}`,onClick:()=>T(e),onMouseDown:w=>w.preventDefault(),children:e},e+c)):!p&&u.length>0&&n.jsx("li",{className:"px-4 py-2 text-gray-600",children:"No matching cities found."})}),n.jsx(M,{name:r,component:"div",className:"text-red-500 text-sm mt-1"})]})};export{X as A,N as C,Y as S};
