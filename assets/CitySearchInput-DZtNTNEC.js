import{r as a,j as w,E as R}from"./index-B1B7tQkZ.js";const I={},B=({formik:o,name:r="",id:A="",label:F="",countryName:l="",getStateName:S=()=>{}})=>{const[y,i]=a.useState(""),[g,x]=a.useState([]),[f,c]=a.useState([]),[u,b]=a.useState(!1),[d,h]=a.useState(-1),[v,C]=a.useState(!1),L=a.useRef(null),E=a.useRef(null);a.useEffect(()=>{(async()=>{if(!l){x([]),c([]),i(""),C(!1);return}if(I[l]){if(console.log(`Using states for ${l} from cache.`),x(I[l]),y){const e=I[l].filter(n=>n.name.toLowerCase().includes(y.toLowerCase()));c(e)}else c([]);const s=o.values[r];i(s||""),C(!1);return}console.log(`Fetching states for ${l} from API.`),C(!0),x([]),c([]);try{const s=await fetch("https://countriesnow.space/api/v0.1/countries/states",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({country:l})});if(!s.ok){console.error(`HTTP error fetching states: ${s.status}`),x([]),c([]),I[l]=[];return}const e=await s.json();e.error||!e.data||!e.data.states?e.data&&e.data.states?(x(e.data.states),I[l]=e.data.states):(console.error("API error fetching states:",e.msg||"Unexpected API response structure"),x([]),c([]),I[l]=[]):(x(e.data.states),I[l]=e.data.states)}catch(s){console.error("Error fetching states:",s),x([]),c([]),I[l]=[]}finally{C(!1);const s=o.values[r];i(s||"")}})()},[l,o.values,y,r]),a.useEffect(()=>{const t=o.values[r];typeof t=="string"?i(t):t||i("")},[o.values,r]);const D=t=>{const s=t.target.value;if(i(s),h(-1),s.length>0&&g.length>0){const e=g.filter(n=>n.name.toLowerCase().includes(s.toLowerCase()));c(e),b(!0)}else c([]),b(!1)},$=t=>{i(t.name),o.setFieldValue(r,t.name),S(t.name),c([]),b(!1),h(-1),o.setFieldTouched(r,!0)},P=t=>{!u||f.length===0||(t.key==="ArrowUp"?(t.preventDefault(),h(s=>s<=0?f.length-1:s-1)):t.key==="ArrowDown"?(t.preventDefault(),h(s=>s===f.length-1?0:s+1)):t.key==="Enter"?(t.preventDefault(),d>=0&&d<f.length&&$(f[d])):t.key==="Escape"&&(b(!1),h(-1),o.setFieldTouched(r,!0)))};return a.useEffect(()=>{const t=s=>{L.current&&!L.current.contains(s.target)&&E.current&&!E.current.contains(s.target)&&(b(!1),h(-1),o.setFieldTouched(r,!0))};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[o,r]),a.useEffect(()=>{if(d!==-1&&E.current){const t=E.current.children[d];t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}},[d,f.length]),w.jsxs("div",{className:"relative flex flex-col gap-3",children:[F&&w.jsx("label",{htmlFor:A,className:"block text-[18px] font-[500] text-[#252C62]",children:F}),w.jsx("input",{ref:L,type:"text",id:A,name:r,value:o==null?void 0:o.values[r],onChange:t=>{o.handleChange(t),D(t)},onKeyDown:P,onFocus:()=>{if(l&&g.length>0){if(y.length>0){const t=g.filter(s=>s.name.toLowerCase().includes(y.toLowerCase()));c(t)}else c(g);b(!0)}},onBlur:t=>{o.handleBlur(t),setTimeout(()=>{b(!1),h(-1)},100)},placeholder:v&&l?"Loading...":l?"Search for a state or province...":"Select a country first...",disabled:!l||v,className:`border border-[#AEC8E2] rounded-[6px] px-4 py-2 w-full ${!l||v?"bg-gray-100 cursor-not-allowed":""}`}),u&&f.length>0&&w.jsx("ul",{ref:E,className:"absolute left-0 top-[100%] z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-60 overflow-y-auto shadow-lg",children:f.map((t,s)=>w.jsx("li",{className:`px-4 py-2 cursor-pointer ${s===d?"bg-blue-100":"hover:bg-gray-100"}`,onClick:()=>$(t),onMouseDown:e=>e.preventDefault(),children:t.name},t.code||t.name||s))}),u&&f.length===0&&y.length>0&&!v&&w.jsx("div",{className:"absolute left-0 top-[100%] z-10 w-full bg-white border border-gray-300 rounded-md mt-1 px-4 py-2 text-gray-600 shadow-lg",children:"No matching states found."}),w.jsx(R,{name:r,component:"div",className:"text-red-500 text-sm mt-1"})]})},T={},z=({formik:o,name:r="",id:A="",label:F="",countryName:l="",stateName:S="",getCityName:y=()=>{}})=>{const[i,g]=a.useState(""),[x,f]=a.useState([]),[c,u]=a.useState([]),[b,d]=a.useState(!1),[h,v]=a.useState(-1),[C,L]=a.useState(!1),E=a.useRef(null),D=a.useRef(null);a.useEffect(()=>{(async()=>{if(!l||!S){f([]),u([]),g(""),L(!1);return}const n=`${l}_${S}`;if(T[n]){if(console.log(`Using cities for ${l}, ${S} from cache.`),f(T[n]),i){const j=T[n].filter(V=>V.toLowerCase().includes(i.toLowerCase()));u(j)}else u([]);const p=o.values[r];g(p||""),L(!1);return}console.log(`Fetching cities for ${l}, ${S} from API.`),L(!0),f([]),u([]);try{const p=await fetch("https://countriesnow.space/api/v0.1/countries/state/cities",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({country:l,state:S})});if(!p.ok){console.error(`HTTP error fetching cities: ${p.status}`),f([]),u([]),T[n]=[];return}const j=await p.json();if(j.error||!j.data)console.error("API error fetching cities:",j.msg||"Unexpected API response structure or no cities found"),f([]),u([]),T[n]=[];else{const V=j.data||[];if(f(V),T[n]=V,i){const O=V.filter(U=>U.toLowerCase().includes(i.toLowerCase()));u(O)}else u([])}}catch(p){console.error("Error fetching cities:",p),f([]),u([]),T[n]=[]}finally{L(!1);const p=o.values[r];g(p||"")}})()},[l,S,o.values,i,r]),a.useEffect(()=>{const e=o.values[r];typeof e=="string"?g(e):e||g("")},[o.values,r]);const $=e=>{const n=e.target.value;if(g(n),v(-1),n.length>0&&x.length>0){const p=x.filter(j=>j.toLowerCase().includes(n.toLowerCase()));u(p),d(!0)}else u([]),d(!1)},P=e=>{g(e),o.setFieldValue(r,e),u([]),d(!1),v(-1),o.setFieldTouched(r,!0),typeof y=="function"&&y(e)},t=e=>{!b||c.length===0||(e.key==="ArrowUp"?(e.preventDefault(),v(n=>n<=0?c.length-1:n-1)):e.key==="ArrowDown"?(e.preventDefault(),v(n=>n===c.length-1?0:n+1)):e.key==="Enter"?(e.preventDefault(),h>=0&&h<c.length&&P(c[h])):e.key==="Escape"&&(d(!1),v(-1),o.setFieldTouched(r,!0)))};a.useEffect(()=>{const e=n=>{E.current&&!E.current.contains(n.target)&&D.current&&!D.current.contains(n.target)&&(d(!1),v(-1),o.setFieldTouched(r,!0))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[o,r]),a.useEffect(()=>{if(h!==-1&&D.current){const e=D.current.children[h];e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})}},[h,c.length]);const s=!l||!S||C;return w.jsxs("div",{className:"relative flex flex-col gap-3",children:[F&&w.jsx("label",{htmlFor:A,className:"block text-[18px] font-[500] text-[#252C62]",children:F}),w.jsx("input",{ref:E,type:"text",id:A,name:r,value:o==null?void 0:o.values[r],onChange:e=>{o.handleChange(e),$(e)},onKeyDown:t,onFocus:()=>{if(l&&S&&x.length>0){const e=x.filter(n=>n.toLowerCase().includes(i.toLowerCase()));u(e),d(!0)}else l&&S&&!C&&(u([]),d(!0))},onBlur:e=>{o.handleBlur(e),setTimeout(()=>{d(!1),v(-1)},100)},placeholder:C?"Loading cities...":l?S?"Search for a city...":"Select a state/province first...":"Select a country first...",disabled:s,className:`border border-[#AEC8E2] rounded-[6px] px-4 py-2 w-full ${s?"bg-gray-100 cursor-not-allowed":""}`}),b&&(c.length>0||i.length>0&&!C||C)&&w.jsx("ul",{ref:D,className:"absolute left-0 top-[100%] z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-60 overflow-y-auto shadow-lg",children:C&&i.length===0?w.jsx("li",{className:"px-4 py-2 text-gray-600",children:"Loading cities..."}):c.length>0?c.map((e,n)=>w.jsx("li",{className:`px-4 py-2 cursor-pointer ${n===h?"bg-blue-100":"hover:bg-gray-100"}`,onClick:()=>P(e),onMouseDown:p=>p.preventDefault(),children:e},e+n)):!C&&i.length>0&&w.jsx("li",{className:"px-4 py-2 text-gray-600",children:"No matching cities found."})}),w.jsx(R,{name:r,component:"div",className:"text-red-500 text-sm mt-1"})]})};export{z as C,B as S};
